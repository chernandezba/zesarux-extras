<HTML>
<HEAD>
<TITLE>Classic 8-bit Computers - Sinclair - ZX Interface 1 and Microdrive manual</TITLE>
<META NAME="keywords" CONTENT="ZX spectrum, interface one, microdrive, ZX">
<META NAME="description" CONTENT="Classic 8-bit Computers, ZX Interface 1 and Microdrive manual">
</HEAD>

<BODY>

<CENTER><H2>ZX Interface 1 and Microdrive manual</H2></CENTER>
<CENTER><H3>Copyright Sinclair Research Limited</H3></CENTER>
<H4>Contents</H4>
<H5>
<UL>
<LI><A HREF="#chapter1">Chapter 1 - setting up your ZX interface 1</A></LI>
	<H6><UL>
	<LI>general setup</LI></UL></H6>

<LI><A HREF="#chapter2">Chapter 2 - Setting up your microdrive</A></LI>
	<H6><UL>
	<LI>handling cartridges</LI>
	<LI>protecting programs and data stored in cartridges</LI>
	<LI>the cartridge lifespan</LI></UL></H6>

<LI><A HREF="#chapter3">Chapter 3 - Starting with your microdrive</A></LI>
	<H6><UL>
	<LI>auto-run</LI>
	<LI>the catalogue</LI>
	<LI>loading programs</LI>
	</UL></H6>

<LI><A HREF="#chapter4">Chapter 4 - Programs and the microdrive</A></LI>
	<H6><UL>
	<LI>saving, verifying, loading and merging programs</LI>
	<LI>erasing programs</LI>
	<LI>formatting and naming blank cartridges</LI>
	<LI>setting up your own auto-run facility</LI>
	</UL></H6>

<LI><A HREF="#chapter5">Chapter 5 - Data, channels and streams</A></LI>
	<H6><UL>
	<LI>Channels and streams</LI>
	</UL></H6>

<LI><A HREF="#chapter6">Chapter 6 - Data and the microdrive</A></LI>
	<H6><UL>
	<LI>opening and naming a data file</LI>
	<LI>entering data</LI>
	<LI>closing file</LI>
	<LI>reading back from a file</LI>
	<LI>note on PRINT and INPUT</LI>
	<LI>reading the file catalogue</LI>
	<LI>protecting a file</LI>
	<LI>extending a file</LI>
	</UL></H6>
	
<LI><A HREF="#chapter7">Chapter 7 - The local area network</A></LI>
	<H6><UL>
	<LI>setting up a network</LI>
	<LI>programs and the network</LI>
	<LI>data and the network</LI>
	<LI>broadcasting</LI>
	</UL></H6>

<LI><A HREF="#chapter8">Chapter 8 - using the RS232 interface</A></LI>
	<H6><UL>
	<LI>connecting peripherals to the RS232 interface</LI>
	<LI>t and b channels</LI>
	<LI>the t channel</LI>
	<LI>the b channel</LI>
	<LI>sending control codes</LI>
	</UL></H6>
	
<LI><A HREF="#chapter9">Chapter 9 - the MOVE statement</A></LI>
	<H6><UL>
	<LI>the printer server program</LI>
	</UL></H6>

<LI><A HREF="#appendix1">Appendix 1 - The net game</A></LI>
<LI><A HREF="#appendix2">Appendix 2 - System variables</A></LI>
<LI><A HREF="#appendix3">Appendix 3 - Microdrive and network channels</A></LI>
<LI><A HREF="#appendix4">Appendix 4 - RS232 connections</A></LI>
<LI><A HREF="#appendix5">Appendix 5 - Reports</A></LI>
<LI><A HREF="#appendix6">Appendix 6 - The extended BASIC</A></LI>
</UL>
</H5>
<HR>

<A NAME="chapter1"></A>
<H3>Chapter 1 - Setting up your ZX interface 1</H3>

Unpacking the ZX interface 1 you will have found:<BR>
<UL>
<LI>this booklet</LI>
<LI>the interface itself (with two captive screws on the underside)</LI>
<LI>a ribbon cable about8cms long (for connecting the interface to a microdrive)</LI>
<LI>a lead with a jack plug at either end (for setting up a network)</LI>
</UL>
To attach the interface to your computer you should:<BR>
<OL>
<LI>Unplug the computer</LI>
<LI>Disconnect the computer from its peripherals</LI>
<LI>Using a posidrive screwdriver remove the two screws on the underside of the computer<BR>
(You will only need these screws again if you later disconnect the interface from the computer.)</LI>
<LI>Push the interface edge connector firmly into the socket at the back of the computer</LI>
<LI>Screw the interface to the underside of the computer using the two captive screws supplied.</LI>
</OL>
You can now reconnect the computer to its peripherals and plug it in.

<HR>
<A NAME="chapter2"></A>
<H3>Chapter 2 - Setting up your microdrive</H3>
Unpacking the microdrive you will have found:
<UL>
<LI>the microdrive itself</LI>
<LI>an electrical connector (for connecting this microdrive to another one)</LI>
<LI>a pre-recorded demonstration cartridge</LI>
</UL>
<P>To attach the microdrive to the interface, push one end of the ribbon cable (supplied with the interface)
firmly into the socket on the side of the interface. Then push the other end of the cable into the socket
in the side of the microdrive.</P>

<P>If you have several micrdrives, the second one can be connected to the first as follows.<BR>
<UL>
<LI>Disconnect the microdrive deom the computer.</LI>
<LI>Turn both microdrives upside down. You will find that each has a bracket screwed to the underside.</LI>
<LI>Unscrew and remove both brackets.</LI>
<LI>Turn both microdrives the right way up.</LI>
<LI>Push one of the electrical connectors firmly into the socket on the side of one of you microdrives.</LI>
<LI>Push the second microdrive up agains the first, so that the other end of the electrical connector pushes into the socket on the side of the second microdrive.</LI>
<LI>Carefully turning the microdrives over again, screw back one of the two brackets,
but this time so that it links up the two microdrives. (The remaining electrical connector,
bracket and screws can be kept for connecting up further microdrives.)</LI>
<LI>Turn the microdrives the right way up again, and reconnect the one on the right-handed </LI>
end to the computer.
</UL></P>
<P>NOTE: the microdrive nearest the computer is always known as microdrive 1, and the next 
along is microdrive 2 and so on. Notice also that on the front of each microdrive there is 
a light which will come on whenever the microdrive is running.</P>

<H4>Handling cartridges</H4>
<P>Every cartridge comes in a protective box; and should always be kept in its box when not in use. When you take a cartridge out of its box (being careful not to touch the tape itself) you will see that it has a level on the top and another on the side. 
Push the cartridge firmly into the slot in the front of the microdrive, making sure that the label on the side faces upwards. This will leave the top of the cartridge projecting by about 1/2 cm. The microdrive and cartridge are now ready to be used.</P>

<P><B>Never take the cartridge out of the drive while the drive light is on. 
Never switch the power on or off while a cartridge is in the drive.
</B></P>

<H4>Protecting programs and data stored in cartridges</H4>
<P>If you wish to protect the programs and data stored in a cartridge (that is, prevent them from being over-written or erased) then you should snap off the plastic tab from the side of the cartridge. (As with a cassette, you can reverse this effect by sticking some tape over the space left where
the tab has been removed.)</P>

<H4>The cartridge lifespan</H4>
<P>Microdrive cartridges will not last forever, and will eventually need to be replaced.
The symptom of an ageing cartridge is that the computer will take longer and longer 
to find a program or file before loading it. So it is a good idea to keep back-up 
copies of important programs or files either on another cartridge, or on cassette.</P>

<HR>
<A NAME="chapter3"></A>
<H3>Starting with your microdrive</H3>
<H4>Auto-run</H4>
<P>Now that you have setup your ZX interface 1 and your microdrive, you will want to know
what programs are waiting for you on the demonstration cartridge. So, insert the cartridge
into the microdrive (or, if you have several microdrives, into drive 1), and enter:<P>
	<B>NEW</B><BR>
followed by:<BR>
	<B>RUN</B> (and <B>ENTER</B>)<BR>
<P>This will automatically load and run the first program on the cartridge. When you
have finished watching this program, read on.</P>

<H4>The catalogue</H4>
<P>To find out what other programs are stored in the demonstration cartridge, enter 
the CATalogue statement:</P>
<B>CAT 1</B> - 1 identifies the microdrive your are using.<BR>
<BR>
In about seven seconds the television screen will display:<BR>
<UL>
<LI>the name of the cartridge</LI>
<LI>an alpabetical catalogue of the names of all the files stored in the cartridge</LI>
<LI>the amount of memory left in the cartridge (in kilobytes)</LI>
</UL>

<H4>Loading programs</H4>
<P>The next thing to do is <B>LOAD</B> whichever program you would like to see next. 
So, first choose your program, then enter:</P>
	<B>LOAD*&quot;m&quot;;1;&quot;<I>name</I>&quot;</B><BR>
Where:<BR>
<TABLE>
<TR><TD>*</TD><TD>indicates to use microdrive instead of tape.</TD></TR>
<TR><TD>&quot;m&quot;;1;&quot;<I>name</I>&quot;</TD><TD>identifies which microdrive you are using and <I>name</I> is the name of the program.</TD></TR>
</TABLE>
<P>After a short pause the screen will display the OK message (though not the name of the program). You can now run the program.</P>

<HR>
<A NAME="chapter4"></A>
<H3>Chapter 4 - Programs and the microdrive</H3>
<H4>Saving, verifying, loading and merging programs</H4>
<P>In the ZX Spectrum introduction booklet you found out how to <B>SAVE</B>
programs on a cassette tape. Saving programs in cartridges is just as easy. 
Here again is a program called Squares, much like the one in the introduction booklet:</P>
<CODE>
10 REM Squares<BR>
20 FOR n=1 TO 10<BR>
30 PRINT n,n*n<BR>
40 NEXT n<BR>
</CODE>

<P>To <B>SAVE</B> this on a cassette tape you would enter: <B>SAVE&quot;squares&quot;</B><BR>
To <B>SAVE</B> it in the cartridge in drive 1, you would enter instead: <B>SAVE*&quot;m&quot;;1;&quot;squares&quot;</B><BR>
After about six seconds the border will flash, and the program will be saved. Try it and see.
(The names of programs stored in a cartridge, like those of programs stored on a cassette tape, can be up to ten characters long.) </P>

<P>As you would expect, you can now check that the program has been saved by entering:<BR>
<BR><B>VERIFY*&quot;m&quot;;1;&quot;squares&quot;</B><BR>
The screen will then display the OK message.<BR>
<BR>You can now <B>LOAD</B> the program squares by entering:<BR>
<B>LOAD*&quot;m&quot;;1;&quot;squares&quot;</B> then <B>ENTER</B><BR>
</P>

Next, to make the program run automatically, try entering:<BR>
	<B>SAVE*&quot;m&quot;;1;&quot;squares2&quot; LINE 10</B><BR>
<BR>then:<BR>
	<B>NEW</B><BR>
and then:
<BR>
	<B>LOAD*&quot;m&quot;;1;&quot;squares2&quot;</B><BR>
<BR>
Programs can also be merged using a microdrive. Enter:<BR>
<CODE>
100 REM more Squares<BR>
110 FOR n=11 TO 20<BR>
120 PRINT n,n*n<BR>
130 NEXT n<BR>
</CODE><BR>
and now enter:<BR>

	<B>MERGE*&quot;m&quot;;1;&quot;squares&quot;</B> then: <B>ENTER</B><BR>

The program squares will be added to the listing.<BR>

<P>In short, as you have probably already realised, all the syntax used within
an ordinary cassette interface applies also to the microdrive.</P>

<H4>Erasing progams</H4>
<P>Suppose you have just finished with the program squares. To erase it, enter: <B>ERASE&quot;m&quot;;1;&quot;squares&quot;</B><BR>
During the <B>ERASE</B> statement the border will flash.<BR>

If you <B>BREAK</B> while saving a program then you will have an unclosed file in the
cartridge. You cannot <B>LOAD</B> an unclosed file, and an attempt to do so will give 
the report <B>file not found</B>. The <B>ERASE</B> statement can delete an unclosed file, but 
will take about thirty seconds to do so because the computer checks the cartridge 
several times to make sure that the file no end.</P>

<H4>Formatting and naming blank cartridges</H4>
<P>If you have bought a blank cartridge, before you can use it you must insert it into a drive and enter this:<BR>
<B>FORMAT&quot;m&quot;;1;&quot;name&quot;</B></P>

<P>Where name is whatever you wish to appear in the cartridge catalogue. 
It can be up to 10 characters. The computer takes avout thirty seconds to format a cartridge. During this time the border 
will first flash, then clear, then flash again, and finally display the OK message. What the computer is doing is identifying any areas that cannot be written to or read from and 
marking them to be avoided.</P>
<P>Formatting need never be repeated. Note, by the way, that when you format a cartridge, any 
information it contains will be erased. So, if you have bought sveral microdrives, you can 
<B>FORMAT</B> your spare demonstration cartridges and use them as blank cartridges.</P>
<P>
Next type:<BR>
	<B>CAT 1</B> where 1 identifies the microdrive number.<BR>

In a few seconds, the television screen will display the cartridge's name and
capacity. The capacity will vary from cartridge to cartridge, but it should never 
be less than 85 kB.</P>

<H4>Setting up your own auto-run facility</H4>
<P>Earlier, you used the auto-run facility on the demonstration cartridge. If you have a 
pgroam that you often use, you can set up your own auto-run facility, so as to avoid 
repeatedly having to type <B>LOAD</B> and <B>RUN</B> statements. These are the 
rules to follow:</P>
<UL>
<LI>the program must be called <B>run</B></LI>
<LI>the cartridge must be in drive 1</LI>
<LI>the facility must be used either immediately after switching on, or immediately 
after a <B>NEW</B> statement.</LI>
</UL>
<P>Now enter: <B>NEW</B> followed by: <B>RUN</B> then <B>ENTER</B><BR>
Note, however, that the <B>MERGE</B> statement does not work with any program saved 
using the <B>SAVE*...LINE...</B> statement. (This is so as to protect such programs.) 
An attempt to <B>MERGE</B> will give the report <B>'Merge' error</B></P>

<HR>
<A NAME="chapter5"></A>
<H3>Chapter 5 - Data, channels and streams</H3>
<P>As, you know, a program is a set of operations which is executed when you type <B>RUN</B>.
Data, on the other hand, is any collections of leters, numbers or symbols on which a 
program might operate. An example is the numbers 1 to 10 with their squares.
<BR>
Data can be sent to, and come from, various parts of a computer system. Such parts
are known as channels. The channels you can send data to are:
<UL>
<LI>your screen</LI>
<LI>a ZX printer</LI>
<LI>a microdrive file, to store it</LI>
<LI>another ZX Spectrum computer, if both computers are on a network</LI>
<LI>the RS232 interface and from there to a modem or printer</LI>
</UL>
And the channels which data can come from are:
<UL>
<LI>the keyboard</LI>
<LI>a microdrive file</LI>
<LI>another ZX Spectrum, if both computers are on a network</LI>
<LI>the RS232 interface, a modem or terminal</LI>
</UL>
<P>The routes along which the data flows to and from these channels are known as streams.
In the spectrum computer system the number of these streams is fixed to sixteen. They 
are numbered from 0 to 15, and stream numbers are preceded by the sign #.
<BR>
Four of these streams come already linked to channels:</P>
<TABLE BORDER=1>
<TR><TD>stream #0</TD><TD ROWSPAN=2> output data to the lower part of the television screen and input from the keyboard</TD></TR>
<TR><TD>stream #1</TD></TR>
<TR><TD>stream #2</TD><TD>outputs to the upper part of the television screen, but cannot input</TD></TR>
<TR><TD>stream #3</TD><TD>outputs via the ZX printer; but cannot input</TD></TR>
</TABLE>
<P>Every statement that produces input or output uses one of these streams automatically.
For example, the <B>PRINT</B> statement uses stream #2, and the <B>LPRINT</B> statement
uses stream #3. So if you enter:<BR>
<CODE><B>PRINT &quot;This is a Spectrum Computer&quot;</B></CODE>
<BR>
it is, in fact, shorthand for:
<BR>
<CODE><B>PRINT #2;&quot;This is a Spectrum Computer&quot;</B></CODE>
<BR>
try entering both and see.
<BR>
You can, however, make any statement use  a different stream by keying # followed by the new 
stream number. Try entering:
<BR>
<CODE><B>LPRINT#2;&quot;This is a Spectrum Computer&quot;</B></CODE>
<BR>
Instead of being printed by the ZX Printer, this line too appears on the screen.
</P>
<P>But as well as using the established stream-channels, you can create some if your own.
Streams #4 to #15 are free for this purpose; and there are various channel specifiers 
which enable you to indicate which peripheral you require. 
Some of these are:</P>
&quot;K&quot; for the keyboard<BR>
&quot;S&quot; for the screen<BR>
&quot;P&quot; for the ZX Printer<BR>
<BR>
(You will be introduced to the other later)</P>

<P>Note that K, S and P are all established channels. They require you to use commas(,)
 as separators in <B>OPEN#</B> statements. But with other channels you can use
either commas or semi-colons(;)</P>

<P>To create you own stream-channels you use the <B>OPEN#</B> statement. For example enter:<BR>
<CODE><B>10 OPEN#4,&quot;S&quot;</B></CODE><BR>
You will have opened stream #4 and linked it to channel S. Now enter:<BR>
<CODE><B>20 PRINT #4;&quot;This is a Spectrum computer&quot;</B></CODE><BR>
Again, the line will appear on the screen.<BR>
(It is not advisable to <B>OPEN</B> to streams 0, 1, or 2 as the results are unpredictable)</P>

<HR>
<A NAME="chapter6"></A>
<H3>Data and the microdrive</H3>
<H4>Opening and naming a data file</H4>
<P>When you store information in a cartridge you keep it in a file. You also give 
the file a name so that you can find it again later. The statement that opens 
and names a data file always takes the same form.</P>
<P>
For example try entering:<BR>
<B>OPEN#4;&quot;m&quot;;1;&quot;numbers&quot;</B><BR>
Where #4 identifies the stream number.<BR>
</P>
<P>This statement does two distinct jobs:
<UL>
<LI>it sets up a new channel: &quot;m&quot;;1;&quot;numbers&quot;</LI>
<LI>it attaches this new channel to stream #4</LI>
</UL>
This will have taken about seven seconds durnig which time the computer
searches the cartridge for a file called &quot;numbers&quot;. Since there is no file
&quot;numbers&quot;, it opens a file for writing. (However, if it had found a file &quot;numbers&quot;, 
it would have opened it for reading. And had it found a <I>program</I> &quot;numbers&quot;, it would 
have given the report <B>Wrong file type</B>.)</P>

<H4>Entering data</H4>
<P>Once you have opened a file you can enter data. Suppose that you want to
store the numbers 1 to 10 with their squares. Enter and run this:</P>
<CODE><B>
10 FOR n = 1 TO 10<BR>
20 PRINT #4,n'n*n<BR>
30 NEXT n<BR>
</B></CODE>

<P>You might think that all the numbers have now been stored away in the cartridge. 
But in fact the computer does not automatically transfer anything to the cartridge 
until a certain amount has built up, which it transfers all at once. This is called
buffering. A microdrive buffer is 512 bytes (or characters) long. To store in the cartridge the data you have entered you must <B>CLOSE</B> the file.
Until this is done you will be unable to read back from the file.
</P>

<H4>Closing a file</H4>
<P>Closing a file ensures that the file is safely stored in the cartridge. It also closes 
the channel (in this case &quot;m&quot;;1;&quot;numbers&quot;) and leaves the stream (in this case#4) with 
no channels attached. To <B>CLOSE</B> a file you need only <B>CLOSE</B> the appropiate 
stream. So enter:</P>
<B>CLOSE#4</B><BR>
<P>The border will then flash to show that something is being store in the cartridge.<BR>
(Note that, like the <B>OPEN</B> statement, the <B>CLOSE</B> statement is followed
automatically by #.)</P>
<P>You cannot by the way, <B>CLOSE</B> streams #0, #1, #2 or #3. If you try to do so, 
streams #0 and #1 will default to channel <B>K</B>; stream #2 will default to channel
<B>S</B>; and stream #3 will default to channel <B>P</B> (see chapter 5)</P>

<H4>Reading back from a file</H4>
<P>To read back from the file &quot;numbers&quot;, run this:<BR>
<CODE><B>
10 OPEN#4;&quot;m&quot;;1;&quot;numbers&quot;<BR>
20 FOR b=1 TO 10<BR>
30 input #4;m;n<BR>
40 PRINT &quot;The square of &quot;;m;&quot; is &quot;;n<BR>
50 NEXT b<BR>
60 CLOSE #4<BR>
<BR>
RUN
</B></CODE>

<P>(Note at this point that because the file &quot;numbers&quot; already exits, the channel 
&quot;m&quot;;1;&quot;numbers&quot; is opened for input, and trying to output to it would give an
error.)</P>

<P>You can also use <B>INKEY$</B> to read back from a ile (it always gives the next 
character in the file). Try this program:</P>
<CODE><B>
10 OPEN #11;&quot;m&quot;;1;&quot;listing&quot;<BR>
20 LIST #11<BR>
30 CLOSE #11<BR>
40 OPEN #12;&quot;m&quot;;1;&quot;listing&quot;<BR>
50 PRINT INKEY$ #12<BR>
60 GO TO 50<BR>
</B></CODE>

<P>This will finish with the End of file report.</P>

<H4>Notes on PRINT and INPUT</H4>
<P>Because the PRINT and INPUT statements are designed mainly for use with the screen 
and keyboard, you must take care when using them with files.</P>

<H5><I>separators</I></H5>
<P>The PRINT statement uses three forms of separator;
<UL>
<LI>the ; (semi-colon) prints nothing,</LI>
<LI>the , (comma) takes you to the start of the next half-line,</LI>
<LI>the ' (apostrophe) gives a new line (the ENTER code).</LI>
</UL>
The INPUT statement expects you to type ENTER after a number or a string. So, when you
are printing to any file from which you expect to INPUT, you must either:</P>
<UL>
<LI>print the items singly, e.g.<BR>
<CODE><B>
10 PRINT #4;2<BR>
20 PRINT #4;3<BR>
</B></CODE>
</LI>
<LI>
separate then with an apostrophe, e.g.
<CODE><B>
10 PRINT #4;2'3<BR>
</B></CODE>
</LI>
</UL>
</P>
<P>You must also take care when using separators in an INPUT statement. As you know, 
INPUT can print to the bottom half of the screen anything that you can put in a PRINT
statement. But when you INPUT from a file, the file is only open for reading. So, if
you include anything that would be printed when using the screen, you will get the error
report <B>Writing to a 'read' file</B>. This means that items in the INPUT statement 
should be separated with a semi-colon, e.g.</P>
<CODE><B>
10 INPUT #4;A;B<BR>
</B></CODE>

<P>Be careful also when you INPUT a string containing &quot; (quotes), because the INPUT will 
think that the &quot; is the end of the string. The way round this is to replace, for example:</P>
<CODE><B>
10 INPUT #4;a$<BR>
</B></CODE>

with<BR>

<CODE><B>
10 INPUT #4;LINE a$<BR>
</B></CODE>

<H5><I>changing streams</I></H5>
<P>PRINT  statements may also contain information for several streams at a time. The 
following program will print &quot;one&quot; on the screen; &quot;two&quot; to a microdrive file called &quot;digits&quot; 
in microdrive 1; &quot;three&quot; to station 1 on a network (see <A HREF="#chapter 7">Chapter 7</A>);
and &quot;four&quot; to the next line on the screen.</P>
<B><CODE>
10 OPEN #4;&quot;m&quot;;1;&quot;digits&quot;<BR>
20 OPEN #5;&quot;n&quot;;1<BR>
30 PRINT &quot;one&quot;;#4;&quot;two&quot;;#5;&quot;three&quot;'#2&quot;four&quot;<BR>
40 CLOSE#4<BR>
50 CLOSE#5<BR>
</CODE></B>

<H5><I>setting colours</I></H5>
<P>After using a channel other than the screen, you may find that the PAPER and INK
statements have no effect. To get round this, enter:</P>
<B><CODE>PRINT;</CODE></B><BR>before setting the PAPER and INK.

<H4>Reading the file catalogue</H4>
<P>As you establish files in a cartridge they are automatically catalogued. So, when
you want to find out what files a cartridge contains, you need only insert the 
cartridge into a microdrive and enter the CAtalogue statement. For example, enter:</P>
<B>CAT 1</B><BR>
<P>The television screen will display:
<UL>
<LI>the cartridge name,</LI>
<LI>the file names,</LI>
<LI>the amount of memory left in the cartridge, (in Kb).</LI>
</UL></P>
<P>You can also send the output of CAT to a stream by entering:</P>
<B>CAT #stream, microdrive number</B>
<P>This enables you to send the catalogue to a printer, or to a file, so that a 
program can use it.</P>

<H4>Protecting a file</H4>
<P>If you do not want a file name to appear on the catalogue, you can protect it by giving it a name beginning with the
character whose <B>CODE</B>is 0. Enter this:</P>
<CODE><B>
10 OPEN #4,&quot;m&quot;;1;CHR$0+&quot;results&quot;<BR>
20 FOR n=1 TO 15<BR>
30 PRINT #4;n;n*n<BR>
40 NEXT n<BR>
50 CLOSE#4<BR>
</B></CODE>
Now enter:<BR>
<B>CAT 1</B>
<P>The file name will not appear. So, whenever you create a protected file, remember to make a note of its name somewhere, in case you forget it later!</P>

<H4>Extending a file</H4>
<P>Suppose you want to extend the file &quot;numbers&quot; to include the squares of numbers 1 to 20 instead of only 1 to 10. You cannot reopen a 
file for writing, so you will have to:
<UL>
<LI>make a new version with a different name;</LI>
<LI>transfer the old file to the new version;</LI>
<LI>add the extra data;</LI>
<LI>delete the old file.</LI>
</UL>
Here is how to do it.<BR>
First, <B>RUN</B> this program:<BR>
<CODE><B>
10 OPEN #4;&quot;m&quot;;1;&quot;numbers&quot;: REM for reading<BR>
20 OPEN #5;&quot;m&quot;;1;&quot;numbers1&quot;: REM for writing<BR>
30 FOR f=1 TO 10<BR>
40 INPUT #4;m;n<BR>
50 PRINT #5;m'n<BR>
60 NEXT f<BR>
70 FOR n=11 TO 20<BR>
80 PRINT #5;n'n*n<BR>
90 NEXT n<BR>
100 CLOSE #4: CLOSE #5<BR>
</B></CODE>
<P>Now, to check that you have got two files, &quot;numbers&quot; and &quot;numbers1&quot;,
enter:<BR>
<B>CAT 1</B><BR>
Next, to delete the old file, enter:<BR>
<B>ERASE &quot;m&quot;;1;&quot;numbers&quot;</B><BR>
To check that it has been deleted, enter:<BR>
<B>CAT 1</B>
<P>The file name &quot;numbers&quot; will have disappeared from the catalogue, and
your new file, &quot;numbers 1&quot; now contains the numbers from 1 to 20.</P>


<HR>
<A NAME="chapter7"></A>
<H3>Chapter 7 - The local area network</H3>
<H4>Setting up a network</H4>
<P>The local area network, or net, enables you and your friends to play
computer games together, and to send each other programs and
data. This means that only one of you need to type in a program. A net
is especially useful, too, if only one of you has a Microdrive.</P>

<P>Using the lead supplied with each Interface you can link up as few as
two and as many as sixty-four Spectrum computers.</P>

<P>Note, however, that you and your friends should not form a loop of
computers: the computers at each end of the net should never be
connected to each other. Each should be left with one net socket free.</P>

<P><B>NEVER SWITCH ON OR OFF A SPECTRUM WHICH IS ON A NET WHILE
COMMUNICATION IS IN PROGRESS.</B><BR>You may, however, have a switched off
Spectrum on the net; and you may also switch on or off Spectrums which
are on a net provided that communication is not in progress.</P>

<P>When you have set up a net, each computer (or station) should be given
a different identification number. So, first decide with your friends
what number each station it to have, and then each of you should
enter:</P>

<CODE><B>FORMAT &quot;n&quot;;stationNumber</B></CODE><BR>

<P>Note, incidentally, that if there are only two computers on a net,
both can use the same station number. And, since both computers, when
switched on, become station 1 automatically, there is no need to use
the <B>FORMAT</B> statement at all.</P>

<H4>Programs and the network</H4>

<P>Let us suppose that you have a friend called Jack and that both of
your computers are on a net. Your station number is, let us say, 1,
and Jack's is 2.</P>

Suppose that you want to send Jack this program:<BR>
<CODE><B>
        10 REM roots<BR>
        20 FOR n=1 TO 10<BR>
        30 PRINT n,SQR n<BR>
        40 NEXT n<BR>
</B></CODE>
Enter the program, followed by:<BR>

<CODE><B>SAVE *&quot;n&quot;;2</B></CODE><BR>
(Notice that the net does not use program names.)<BR>

Meanwhile, Jack should enter:<BR>

<CODE><B>FORMAT &quot;n&quot;;2</B></CODE><BR>

followed by:<BR>

<CODE><B>LOAD *&quot;n&quot;;1</B></CODE><BR>

<P>Jack will now have a copy of the program. Notice, though, that while
the computer is waiting to SAVE or LOAD a program over the net, the
border of the screen goes black until the program is sent. You
computer will not send until Jack's is ready, and Jack's will wait
until something is sent. Try entering your SAVE line before Jack
enters his LOAD line, and vice versa.</P>

To verify that Jack now has a copy of your program, he should enter:<BR>

<CODE><B>VERIFY *&quot;n&quot;;1</B></CODE><BR>

while you repeat the sending of the program by entering:<BR>

<CODE><B>SAVE *&quot;n&quot;;2</B></CODE><BR>

<P>SAVE is, in fact, the only statement that sends programs over the
net. The LOAD, VERIFY and MERGE statements are all ways of receiving
programs.</P>

<P>The net game in <A HREF="#appendix1">Appendix 1</A> is a good example of how to use programs
with a network.</P>

<H4>Data and the network</H4>
<P>Suppose that you want to send Jack some data. The statement <B>OPEN
#4;&quot;n&quot;;2</B> opens a channel to station 2 on the net (&quot;n&quot;), and attaches
stream #4, to it, so that when you output along stream #4, your
message will be put on the net with a note saying that it comes from
you.</P>

<P>(Conversely, were you to enter INPUT #4;&quot;n&quot;;2 your computer would wait
for information addressed to you from Jack.)</P>

Now enter this programs:<BR>
<CODE><B>
10 OPEN #4;&quot;n&quot;;2: REM for output<BR>
20 INPUT a$: PRINT #4;a$<BR>
30 CLOSE #4<BR>
40 OPEN #4;&quot;n&quot;;2: REM for input<BR>
50 INPUT #4;b$: PRINT b$<BR>
60 CLOSE #4<BR>
70 GO TO 10<BR>
</B></CODE>
Then enter:<BR>
<B>SAVE *&quot;n&quot;;2</B><BR>
Now ask Jack to enter:<BR>
<B>FORMAT &quot;n&quot;;2</B><BR>
Then:<BR>
<B>LOAD *&quot;n&quot;;1</B>

<P>You should now run your program, and Jack should edit lines 10 and 40
of the program to make them refer to station 1 not station 2. He
should then enter:</P>

<B>GO TO 40</B>

<P>You are now ready to start a conversation. But before you do so there
are three things you should know:</P>
<UL>
<LI>Your output along stream #4 is buffered: that is, it is not automatically put on the net until a certain amount of output has
accumulated. So whenever you finish outputting you should CLOSE the stream. This will send the buffer even if it is not full. (The 
buffers are 255 bytes, or characters, long.)</LI>
<LI>Your output is marked as coming specifically from you, so that if Jack is inputting or waiting for output from a different net
channel, your message will be ignored. If your message has been ignored your screen will not display the OK message, and the border 
of the screen will go black, until Jack asks to receive the message.</LI>
<LI>Though the INPUT statement simply waits for something to be sent, the INKEY$ statement can be used to read the net. It will return 
with the first byte of anything that either has been sent, or is waiting to be sent. (Otherwise it will return the empty string.)
This is known as polling. (INKEY$, in fact, works the same way with the net as it does with the keyboard.)</LI>
</UL>
The program below will print anything being sent to it by station 1:<BR>
<CODE><B>
10 OPEN #8;&quot;n&quot;;1<BR>
20 PRINT INKEY$ #8;<BR>
30 GO TO 20<BR>
</B></CODE>
(For more on INKEY$ see chapter 18 of the BASIC programming manual.)<BR>


<H4>Broadcasting</H4>
<P>
There is also a special net channel called broadcast whose channel
specifier is &quot;n&quot;;0. When you input from this channel you will pick up
any message that is being broadcast. And when you output, you message
can be read by anyone who is inputting from channel &quot;n&quot;;0.</P>

<P>This could, for example, be very useful at school if every pupil in a
class has a Spectrum computer, but only the teacher has a Microdrive.</P>

<P>Suppose the teacher wished to broadcast a program. First, the pupils
should enter:</P>

<B>LOAD *&quot;n&quot;;0</B>

</P>This will leave the pupils 'waiting' to receive the program. The
teacher should then save the program by entering:</P>

<B>SAVE *&quot;n&quot;;0</B>

<P>As you may have guessed, broadcast (unlike private messages) are sent
at once, and do not wait for other computers to be ready to receive
them.</P>

<P>Note, by the way, that when you send a broadcast, the computer does
not let you know if anyone has received it.</P>

<P>Note also that INKEY$ will not poll the broadcast channel. Like INPUT,
it will simply wait for something to be sent.</P>

<HR>
<A NAME="chapter8"></A>
<H3>Chapter 8 - using the RS232 interface </H3>
<H4>Connecting peripherals tot he RS232 Interface</H4>

<P>As you know, the Spectrum character set comprises both single symbols
(letters, digits, etc.) and compound tokens (keywords, function names,
etc.). All these characters can be sent and received by the RS232
Interface to and from any compatible serial device; for example, a
printer, a modem or another RS232 Interface connected to a different
kind of computer.</P>

<P>To connect any of these peripherals to the RS232, you should use a
lead with a 9-way D-plug on one end and an appropriate plug for you
peripheral on the other. You should insert the D-plug into the back of
the RS232, as shown below. (For wiring details, see Appendix 4.)</P>

<P>Next, before you can use the RS232 you will need to adjust some of the
settings on the peripheral. These may include:</P>
<UL>
<LI>auto line feed, which should normally be switched to off. (The
  Spectrum outputs a carriage return and a line feed on a &quot;t&quot; channel
  but a carriage return only on a &quot;b&quot; channel. These t and b channels
  are explained below.)</LI>
<LI>parity on/off, which should be set off.</LI>
<LI>the number of bits, since the Spectrum puts out eight bits.</LI>
<LI>the number of stop bits, since the Spectrum puts out one stop bit.</LI>
<LI>the baud rate (i. e. the number of bits per second). The Spectrum
  can operate at all standard baud rates, i. e.:
  50, 110, 300, 600, 1200, 2400, 4800, 9600 and 19,200.</LI>
</UL>
<P>You should set your peripheral to use the highest baud rate of which
  it is capable. (You will see later how to set the Spectrum to use
  the same baud rate.)</P>

<P>For an explanation of how to make these adjustments, consult the
instruction book supplied with your peripheral.</P>


<B>T and b channel</B>

<P>The RS232 uses two different channels: the t channel and the b
channel.</P>


<B>The t channel</B>

<P>The t (or text) channel is normally used to send listings. Channel t
has the following effect on the character set:</P>

<TABLE>
<TR><TD COLSPAN=2>characters</TD></TR>
<TR><TD>0-31</TD><TD>(the control codes) are not sent, except 13 (carriage
                return) which is sent as 13 followed by 10 (carriage
                return and line feed).</TD></TR>
<TR><TD>32-127</TD><TD>(the ASCII code) are sent as normal.</TD></TR>
<TR><TD>128-164</TD><TD>(the graphics characters) are not sent. The message ?
                (code 63) is sent instead.</TD></TR>
<TR><TD>165-255</TD><TD>(the tokens) are expanded into ASCII codes 32-127</TD></TR>
</TABLE>

<P>On INPUT and INKEY$ the t channel expects 7 bits characters, so it
ignores the 8th bit if there is one.</P>

<P>To use the t channel, first you must tell the computer which baud rate
to use. So enter:</P>

<CODE><B>10 FORMAT &quot;t&quot;;baud rate</B></CODE>

<P>Now to OPEN a stream to it, enter:</P>
<CODE><B>
20 OPEN #3;&quot;t&quot;<BR>
30 LLIST
</B></CODE>

<P>The border of the screen will flash and the listing will be sent to
the peripheral. (Notice that LLIST is shorthand for LIST #3.) Now
enter:</P>

<B>LPRINT &quot;This is a short message.&quot;</B>

<P>If your ZX Interface is connected to a terminal or an RS232 device
capable of sending, then you can INPUT from the terminal or
device. Enter this:</P>
<CODE><B>
        10 FORMAT &quot;t&quot;;baudrate<BR>
        20 OPEN #4;&quot;t&quot;<BR>   
        30 PRINT INKEY$ #4;<BR>      
        40 GO TO 30<BR>              
</B></CODE>
<P>Now, whatever you type on the terminal or device will appear on your
screen.</P>


<B>The b channel</B>

<P>The b (or binary) channel sends the full 8 bit codes used by the
Spectrum, and allows you to send control codes to printers etc.</P>

<P>With INPUT and INKEY$ the b channel expects 8 bit characters.</P>

<P>SAVE and LOAD will only work with the b channel.</P>

<P>If you are using modems to connect your computer with another Spectrum
over a 'phone line; or if you are storing your programs on a different
kind of computer which also has an RS232 Interface, you may well want
to SAVE and LOAD over the RS232 Interface. To do this, enter:</P>

<CODE><B>FORMAT &quot;b&quot;;baudrate</B></CODE>

<P>Now, for example, enter:
<CODE><B>
        10 REM figures<BR>
        20 FOR n=1 TO 10<BR>
        30 PRINT n,n*RND<BR>
        40 NEXT n<BR>
</B></CODE>

<P>followed by:</P>

<CODE><B>SAVE *&quot;b&quot;</B></CODE>

<P>If this program is being send via modem, someone at the other end
should enter:</P>

<CODE><B>LOAD *&quot;b&quot;</B></CODE>

<P>The usual extensions are also possible, such as:</P>

<CODE><B>SAVE *&quot;b&quot;;SCREEN$</B></CODE><BR>
and:<BR>
<CODE><B>SAVE *&quot;b&quot;;LINE number</B></CODE><BR>
<BR>

<B>Sending control codes</B>

<P>Many printers allow you to send instructions for such operations as
double width printing. To send these you should use the b
channel. However, with the b channel, the carriage return does not
include a line feed. So you will have either to change the settings on
your printer, or print the line feed code: 10.</P>

<P>For example, suppose that the control code for double width printing
is 14. Enter:</P>
<B><CODE>
10 OPEN #4;&quot;b&quot;<BR>
20 PRINT #4;&quot;Normal width&quot;<BR>
30 PRINT #4;CHR$ 14;&quot;Double width&quot;<BR>
40 CLOSE #4<BR>
</CODE></B>
<P>(For the correct control codes to use, refer to your printer's
instruction book.)</P>

<P>You can have both b and t channels at once. Try entering this:</P>

<B><CODE>10 OPEN #5;&quot;b&quot;<BR>
20 OPEN #6;&quot;t&quot;<BR>
30 PRINT #5;CHR$ 14;<BR>
40 LIST #6<BR>
50 CLOSE #5: CLOSE #6<BR>
</CODE></B>
<P>This would give you a double width listing.</P>


<HR>
<A NAME="chapter9"></A>
<H3>Chapter 9 - the MOVE statement</H3>
<P>So far, you have only been able to move data from a program to a
channel or vice versa. The MOVE statement, however, enables you to
move data from one channel to another. For example, to move data from
the keyboard to the screen, enter:</P>

<B><CODE>10 MOVE #1 TO #2</CODE></B><BR>
<BR>
then:<BR>

<B><CODE>RUN</CODE></B>

<P>Anything you type on the keyboard will now appear on the
screen. However, you will discover that when you press BREAK this only
prints a space on the screen. To escape from this trap, press ENTER
until the print position reaches the bottom of the screen. The, when
the computer asks 'scroll?' you should press BREAK. (You should, by
the way, avoid moving data from the keyboard to any other stream since
you may be unable to BREAK out of such a mode.)</P>

<P>Using the MOVE statement you can also examine files stored in
cartridges. For example, set up the file &quot;Numbers&quot; and then, to
examine its contents, enter:</P>

<B><CODE>10 MOVE &quot;m&quot;;1;&quot;Numbers&quot; TO #2</CODE></B>

<P>(Note that you need not OPEN or CLOSE the file yourself. MOVE does
this.)</P>

<P>Similarly, to make a copy of the file &quot;Numbers&quot; enter:</P>

<B><CODE>10 MOVE &quot;m&quot;;1;&quot;Numbers&quot; TO &quot;m&quot;;1;&quot;Numbers 2&quot;</CODE></B>

<P>Here, MOVE opens a stream for reading from the existing file
(&quot;Numbers&quot;) and another for writing to the new file (&quot;Numbers
2&quot;). Next, it reads the data in &quot;Numbers&quot; and writes it out in
&quot;Numbers 2&quot;. Then it closes both streams.</P>

<P>MOVE will work with stream numbers (such as #4), and with channel
specifiers (such as &quot;m&quot;;1;&quot;Numbers&quot;). Note, however, that the
established streams, #1 to #3, may not be specified by the channel
specifiers K, S or P.</P>

<P>If you have a second Microdrive, you can use the MOVE statement to
make back-up copies of data in another cartridge. Enter:</P>

<B><CODE>10 MOVE &quot;m&quot;;1;&quot;Numbers&quot; TO &quot;m&quot;;2;&quot;Numbers 2&quot;</CODE></B>

<P>(Note that MOVE only works with data files. If you want a back-up copy
of a program, you must LOAD the program, and then SAVE it.)</P>

<P>It is sensible to make back-up copies of any data or programs you want
to keep.</P>

<P>The MOVE statement can also send files to a printer. So if you have a
ZX Printer, enter:</P>

<B><CODE>10 MOVE &quot;m&quot;;1;&quot;Numbers&quot; TO #3</CODE></B>

<H4>The Printer Server program</H4>

<P>This program allows one Spectrum on a net to control an RS232
printer. The printer can then be used by all other computers on the
net. This is useful, for example, if a group of people using Spectrums
have only one high quality printer among them which they wish to
share. The program also shows a powerful use of the MOVE statement.</P>

<P>The Printer Server computer must always be station 64, and must always
make contact with station 62 (which is a contact establishing
station). So the sender temporarily uses station 62, and sends it his
real station number from which it then moves a files to the t
channel. To set up a Printer Server station use this program:</P>

<B><CODE>
10 FORMAT &quot;n&quot;;64<BR>
20 OPEN #4;&quot;n&quot;;62: INPUT #4;a$: CLOSE #4<BR>
30 MOVE &quot;n&quot;; CODE a$ TO &quot;t&quot;<BR>
40 OPEN #4;&quot;b&quot;: PRINT #4;CHR$ 12: CLOSE #4: RUN<BR>
</CODE></B>

<P>(Line 40 sends a form feed.)</P>

<P>The program below is the one send by the sender. First, the sender's
station is temporarily set to station 62. Then, the sender's real
station number is sent. Next the sender's station sets itself back to
its real number. Last, line 60 sends whatever data is to be printed
(in this case, the listing).</P>
<B><CODE>
10 LET station=number<BR>
20 FORMAT &quot;n&quot;;62 \-- enter here the sender's real station number<BR>
30 OPEN #4;&quot;n&quot;;64: PRINT #4;CHR$ station: CLOSE #4<BR>
40 FORMAT &quot;n&quot;;station<BR>
50 OPEN #4;&quot;n&quot;;64<BR>
60 LIST #4<BR>
70 CLOSE #4<BR>
</CODE></B>

<HR>
<A NAME="appendix1"></A>
<H3>Appendix 1 - The net game</H3>
<P>There is a copy of this game on the demonstration cartridge supplied
with the Microdrive. Its file name is &quot;net game&quot;. The program gives a
good example of how the net can be used. Parts of it might usefully be
included in programs of your own.</P>

<H4>The game</H4>

<P>To play this game, you and your opponent must each think of a number
between 1 and 100. The winner of the game is the one who guesses his
opponent's number first. At each guess you make, your computer will
tell you how close you are getting.</P>


<H4>The program</H4>

<P>The subroutine at line 500 decides who is user 1 and who is user
2. This is so that, when you exchange guesses, one of you uses the
subroutine at line 1100, and the other uses the subroutine at line
1200 and thus user 1 sends first and user 2 receives first.</P>

<P>Your computer decides who is user 1 by sending your opponent's
computer the message &quot;1&quot;, and then listening. If it receives back a
&quot;1&quot;, this means that opponent's computer was switched on after
yours. Your computer therefore sends a &quot;2&quot; to your opponent's
computer, and makes itself user 1. (If, on the other hand, your
computer receives back a &quot;2&quot;, this means that your opponent sent the
&quot;1&quot;. Your computer will therefore make itself user 2.)</P>

<P>If both computers start at the same time they collide and it will be
necessary to BREAK and start again.</P>

<P>The body of the program is involved with exchanging names, inputting
the secret number (which is not sent) and then comparing
guesses. First guesses are sent, and then the replies.</P>

<P>Lines 190 onwards detect a win, signal it appropriately, and then
offer another game.</P>
<B><CODE>
  10 GO SUB 500<BR>
  20 PRINT ;: BORDER 1: PAPER 1: INK 7: CLS<BR>
  30 PRINT &quot; Number guessing game&quot;''&quot;First enter your secret number,<BR>
     then guess your opponent's&quot;<BR>
  40 INPUT &quot;What is your name?&quot;;a$<BR>
  50 PRINT ''&quot;Hello &quot;;a$<BR>
  60 GO SUB 1000+100*user<BR>
  70 PRINT &quot;You are playing &quot;;b$<BR>
  75 PRINT 'a$,b$<BR>
  80 INPUT &quot;Think of a number (1 to 100)&quot;;a<BR>
  90 IF a&lt;1 OR a&gt;100 OR a&lt;&gt;INT a THEN GO TO 80<BR>
 130 INPUT &quot;Make a guess &quot;;b<BR>
 140 LET a$=STR$ b: GO SUB 1000+100*user<BR>
 150 LET c=ABS(a-VAL b$)<BR>
 160 IF c=0 THEN LET a$=&quot;Right&quot;: GO TO 170<BR>
 161 IF c&lt;4 THEN LET a$=&quot;Very very close&quot;: GO TO 170<BR>
 162 IF c&lt;10 THEN LET a$=&quot;Very close&quot;: GO TO 170<BR>
 163 IF c&lt;20 THEN LET a$=&quot;close&quot; : GO TO 170<BR>
 164 IF c&lt;40 THEN LET a$=&quot;fairly close&quot;: GO TO 170<BR>
 165 IF c&lt;60 THEN LET a$=&quot;not very close&quot;: GO TO 170<BR>
 166 LET a$=&quot;nowhere near&quot;<BR>
 170 GO SUB 1000+100*user<BR>
 180 PRINT b$,a$<BR>
 190 IF c=0 OR b$=&quot;Right&quot; THEN GO TO 210<BR>
 200 GO TO 130<BR>
 210 IF b$=&quot;Right&quot; THEN PRINT FLASH 1;&quot;Victory&quot;: FOR n=1 TO 7:<BR>
     BORDER n: BEEP .1,n: BEEP .1,n+16: NEXT n: GO TO 230<BR>
 220 PRINT &quot;Defeat&quot;: FOR n=7 TO 0 STEP -1: BORDER n: BEEP .2,n: NEXT n<BR>
 230 BORDER 1: INPUT &quot;Another game? (y/n)&quot;;a$<BR>
 240 IF a$=&quot;y&quot; THEN RUN 20<BR>
 499 STOP<BR>
 500 OPEN #4;&quot;n&quot;;0<BR>
 510 PRINT #4;&quot;1&quot;<BR>
 520 CLOSE #4<BR>
 530 OPEN #4;&quot;n&quot;;0<BR>
 540 INPUT #4;a$<BR>
 545 CLOSE #4<BR>
 550 LET a=4: IF a$=&quot;1&quot; THEN OPEN #a;&quot;n&quot;;0: PAUSE 5: PRINT #4;&quot;2&quot;:<BR>
     LET user=1<BR>
 560 IF a$=&quot;2&quot; THEN LET user=2<BR>
 570 CLOSE #4<BR>
 580 FORMAT &quot;n&quot;;user: RETURN<BR>
1100 OPEN #4;&quot;n&quot;;3-user<BR>
1110 PRINT #4;a$<BR>
1120 CLOSE #4<BR>
1130 OPEN #4;&quot;n&quot;;3-user<BR>
1140 INPUT #4;b$<BR>
1150 CLOSE #4<BR>
1160 RETURN<BR>
1200 OPEN #4;&quot;n&quot;;3-user<BR>
1210 INPUT #4;b$<BR>
1220 CLOSE #4<BR>
1230 OPEN #4;&quot;n&quot;3-user<BR>
1240 PRINT #4;a$<BR>
1250 CLOSE #4<BR>
1260 RETURN<BR>
</CODE></B>

<HR>
<A NAME="appendix2"></A>
<H3>Appendix 2 - system variables</H3>
<P>In addition to the system variables given in Chapter 25 of the
Spectrum BASIC programming manual, the Microdrive, local area network
and RS232 software use the system variables below.</P>

<PRE>
Notes   Address Name    Contents
X1      23734   FLAGS3  Flags
X2      23735   VECTOR  Address used to extend the BASIC interpreter
X10     23737   SBRT    ROM paging subroutine
2       23747   BAUD    Two byte number determining the baud rate
                        calculated as follows:
                        BAUD=(3500000 / (26 * baud rate)) - 2
1       23749   NTSTAT  Own network station number
1       23750   IOBORD  Border colour used during I/O. You can poke
                        any colour you want.
N2      23751   SER_FL  2 byte workspace used by RS232
N2      23753   SECTOR  2 byte workspace used by Microdrive
N2      23755   CHADD_  Temporary store for CH_ADD
1       23757   NTRESP  Store for network response code
1       23758   NTDEST  Beginning of network buffer contains
                        destination station number 0-64
1       23759   NTSRCE  Source station number
X2      23760   NTNUMB  Network block number 0-65535
N1      23762   NTTYPE  Header type code
X1      23763   NTLEN   Data block length 0-255
N1      23764   NTDCS   Data block checksum
N1      23765   NTHCS   Header block checksum
N2      23766   D_STR1  Start of 8 byte file specifier
                        2 byte drive number 1-8
N1      23768   S_STR1  Stream number 1-15
N1      23769   L_STR1  Device type... &quot;m&quot;, &quot;n&quot;, &quot;t&quot; or &quot;b&quot;
N2      23770   N_STR1  Length of file name
N2      23772   D_STR2  Second 8 byte file specifier
                        used by MOVE and LOAD commands
N1      23782   HD_00   Start of workspace for SAVE, LOAD, VERIFY and
                        MERGE data type code
N2      23783   HD_0B   Length of data 0-66535
N2      23785   HD_0D   Start of data 0-65535
N2      23787   HD_0F   Program length 0-66535
N2      23789   HD_11   Line number
1       23791   COPIES  Number of copies made by SAVE
        23792   Start of Microdrive MAPs or CHANS
</PRE>
<H4>Warnings</H4>
<OL>
<LI>Opening a stream to the Microdrive or net requires a certain amount
   of free memory with which to create a channel. A Microdrive channel
   is 595 bytes, and a net channel is 276 bytes. These channels will
   be created either by OPEN #, MOVE or by SAVE / LOAD / VERIFY /
   MERGE. This means that an existing program with insufficient room
   below RAMTOP will give the report 'Out of memory' to any of these
   operations.</LI>

<LI>Another effect of the creation of these buffers is to move machine
   code stored in a REM statement. This may create problems. So always
   put machine code programs above RAMTOP.</LI>

<LI>It is inadvisable to BREAK during a Microdrive write operation (one
   during which the border is flashing), since you may end up with an
   unclosed file. ERASE will remove unclosed files, but will take
   about thirty seconds to do so, as the computer checks the cartridge
   several times to make sure that the file has no end.</LI>
</OL>

<HR>
<A NAME="appendix3"></A>
<H3>Appendix 3 - Microdrive channel</H3>
<P>Every time a file is opened an area called a CHANNEL is created in the
area designated CHANS in the BASIC programming manual. This area is
usually addressed by the IX register in the software. The channel has
a length of 596 bytes, and contains the 512 byte buffer.</P>

<P>The contents of the channel are as follows:</P>
<PRE>
0               Address 8
2               Address 8
4               'M'
5               Address of output subroutine in ROM
7               Address of input routine in ROM
9               Address 595
11      CHBYTE  Current byte counter indicates the next byte to be
                added or removed from the data area in the range 0-512
                inclusive
13      CHREC   Record number. Indicates the position of the record in
                a file range 0-255
14      CHNAME  10 byte filename with trailing spaces
24      CHFLAG  Flag byte       bit 0    set...open for write
                                         clear open for read
                                bits 1-7 unused
25      CHDRIV  Drive number 0-7
26      CHMAP   Address of the MAP for this Microdrive
28      CHMAP   12 bytes of header preamble... marks the start of the
                header workspace
40      HDFLAG  Flag byte       bit 0    set
                                bits 1-7 unused
41      HDNUMB  Sector number in range 0-255
42              Unused
44      HDNAME  Cartridge name and trailing spaces
54      HDCHK   Header checksum
55              12 Bytes of data block preamble... marks the start of
                the data workspace
67      RECFLG  Flag byte bit 0 = 0
                          bit 2 = not a PRINT file
                          bit 3-7 unused
68      RECNUM  Number of this record in the range 0-255
69      RECLEN  Number of bytes of data in this record 0-512
71      RECNAM  Filename with trailing spaces
81      DESCHK  Checksum of the preceding 14 bytes
82      CHDATA  512 bytes of data
594     DCHK    Checksum of the preceding 512 bytes
</PRE>

<H4>Map</H4>

<P>For every Microdrive containing an opened file there is an area called
MAP created in the area called &quot;Microdrive maps&quot; in the BASIC
Programming manual. The MAP contains 32 bytes. Each bit corresponds to
a sector on the corresponding Microdrive. If that sector contains data
or if it is unusable then the bit is set. The bits are numbered as
follows: bit 0 byte 0 = sector 0, bit 1 byte 0 = sector 1, bit 0 byte
1 = sector 8, and so on.</P>


<H4>Network channel</H4>

<P>When a stream is opened to the network, a channel is created in the
area designated CHANS in the BASIC Programming manual. This area is
usually addressed by the IX register in the software. The channel has
a length of 276 bytes, and contains the 255 bytes buffer.</P>

<P>The contents of the channel are described as follows:</P>
<PRE>
0               Address 8
2               Address 8
4               &quot;N&quot;
5               Address of output subroutine in ROM
7               Address of input subroutine in ROM
9               Address 276
11      NCIRIS  The destination station number
12      NCSELF  The Spectrum's station number
13      NCNUMB  The block number
15      NCTYPE  The packet type code... 0 data, 1 EOF
16      NCOBL   Number of bytes in the data block
17      NCDCS   The data checksum
18      NCHCS   The header checksum
19      NCCUR   The position of the last character taken from the
                buffer
20      NCIBL   The number of bytes in the input buffer
21      NCB     A 255 byte data buffer
</PRE>

<HR>
<A NAME="appendix4"></A>
<H3>Appendix 4 - RS232 connections</H3>
<CENTER>
<PRE>
/----------------------\
\ 5 o   o   o   o   o 1/
 \  9 o   o   o   o 6 /
  \------------------/
</PRE></CENTER>
<P>The RS232 socket is wired as follows:</P>
<BR>
1. No connection<BR>
2. TX data (input)<BR>
3. RX data (output)<BR>
4. DTR (input) this should be high when ready<BR>
5. CTS (output) this should be high when ready<BR>
6. N.c.<BR>
7. Ground (pull down)<BR>
8. N.c.<BR>
9. +9V (pull up)<BR>

<P>An RS232 cable is available from Sinclair Research, which connects
the 9 way D-socket to a 25 way D-plug (25 way D-sockets are common on
RS232 peripherals). For details of how to obtain this cable, see the
software and peripherals catalogue included with the ZX Interface
1. This cable is wired as follows:</P>
<BR>
 2. TX data<BR>
 3. RX data<BR>
 5. CTS<BR>
 6. +9V (normally DSR)<BR>
 7. Ground<BR>
20. DTR<BR>

<HR>
<A NAME="appendix5"></A>
<H3>Appendix 5 - Reports</H3>
<P>Now that you have attached a ZX Interface 1 to your computer, your
programs may produce reports which are not described in Appendix B of
the BASIC programming manual. Such reports will be followed by the
line number and the statement number at which the program stopped.</P>

<P>These new reports are explained (in alphabetical order) below.</P>


<B>Code error</B>
<P>You have tried to LOAD a code block that is larger than the
destination area specified by your LOAD statement.</P>


<B>Drive 'write' protected</B>
<P>You have tried to write data to a Microdrive containing a protected
cartridge (i. e. one with the plastic tab on the side removed).</P>


<B>File not found</B>
<P>This means that either you have tried to LOAD from a file which does
not exist, or part of the file cannot be found. (This would either be
because the file has not been closed, or because the file has been
damaged by the power being switched on or off while the cartridge was
in a Microdrive.)</P>


<B>Invalid device expression</B>
<P>A device has been specified other than s, p, k, m, n, t or b. The same
report can be produced if a semi-colon, rather than a comma, is used
with one of the channels s, p or k.</P>


<B>Invalid drive number</B>
<P>A Microdrive number has been specified outside the range 1 to 8.</P>


<B>Invalid name</B>
<P>A file name has been specified as an empty string or a string with
more than ten characters.</P>

<B>Invalid station number</B>
<P>A network station has been specified outside the range 0 to 6 (or
outside the range 1 to 64 for FORMAT statements).</P>


<B>Invalid stream number</B>
<P>A stream has been specified outside the range 0 to 15.</P>


<B>Merge error</B>
<P>You have tried to MERGE data or code. You can only MERGE
programs. This report will also appear if you have tried to MERGE a
program saved by the SAVE... LINE... statement.</P>


<B>Microdrive full</B>
<P>You have tried to write data to a cartridge containing no free
space. You should therefore run your program or command again, with a
cartridge that does contain free space. This can be done by erasing
old files from the present cartridge. A file opened for writing on
the full cartridge cannot be closed. It should be erased. This will,
however, take about thirty seconds because the computer checks the
cartridge several times to make sure that the file has no end.</P>


<B>Microdrive not present</B>
<P>You have either tried to use a Microdrive which is not attached to
your computer, or a Microdrive which does not contain a cartridge, or
a Microdrive containing an unformatted cartridge.</P>


<B>Missing baud rate</B>
<P>The baud rate has not been specified.</P>

<B>Missing drive number</B>
<P>The Microdrive number has not been specified.</P>


<B>Missing name</B>
<P>The file name has not been specified.</P>


<B>Missing station number</B>
<P>The network station number has not been specified.</P>


<B>Program finished</B>
<P>You have tried to execute a line beyond any existing line. This report
will appear if a GO TO instruction is followed by a number beyond any
existing line. It will also appear if RUN is typed without a program.</P>

<B>Read a 'write' file</B>
<P>You have tried to input from a file which does not yet exist, or
which has already been opened for input.</P>


<B>Stream already open</B>
<P>You have tried to OPEN to a stream which has already been opened to a
new channel (m, n, t or b). The stream can only be opened if it is
first closed.</P>


<B>Verification has failed</B>
<P>A saved file does not agree with the program, data or code currently
in the computer.</P>


<B>Writing to a 'read' file</B>
<P>You have tried to output data to an existing file. The existing file
should be erased if it is not needed. Otherwise, a new file should be
used.</P>


<B>Wrong file type</B>
<P>You have tried to INPUT or MOVE a saved file or to LOAD, VERIFY or
MERGE a PRINT type of file, or to LOAD a CODE or DATA files as a
program (or vice versa).<BR>

If you are using INPUT then you should be using LOAD. If you are using
LOAD then either you should use the CODE to DATA options or you should
use INPUT.</P>

<HR>
<A NAME="appendix6"></A>
<H3>Appendix 6 - the extended BASIC</H3>
<P>The ZX Interface 1 extends the BASIC already in the Spectrum. The
extensions and additions are summarised below.</P>


<B>Streams</B>

<P>Streams are specified as #n where n is a number in the range
1-15. Streams 1, 2 and 3 are usually used by BASIC. The # character is
part of the keyword for the OPEN # and CLOSE # statements.</P>


<B>Channels</B>

<P>There are seven types of channel in the extended BASIC; the keyboard
(k), the screen (s), the ZX Printer (p), the text RS232 Interface (t),
the binary RS232 Interface (b), the network (n) and the Microdrive
(m).</P>

<P>Each channel type is specified by its letter which may be upper case
or lower case. The network and the Microdrive require additional
information to specify the channel completely.</P>

<P>A network channel requires a station number, so a network channel is
specified as &quot;n&quot;;x where x is a station number in the range 0-64.</P>

<P>A Microdrive channel requires a Microdrive number and a file name, so
a Microdrive channel is specified as &quot;m&quot;;y;&quot;name&quot; where y is the
Microdrive number in the range 1-8 and &quot;name&quot; is a string of between 1
and 10 characters.</P>

<B>Statements</B>
<TABLE>
<TR><TD VALIGN="TOP">CAT y</TD><TD>Gives a list of all the files in the cartridge in Microdrive y. The list is presented in alphabetical order and is preceded by the name of the cartridge and followed by the remaining capacity in kilobytes.</TD></TR>
<TR><TD VALIGN="TOP">CAT #z;y</TD><TD>Sends the catalogue of the cartridge in Microdrive y, as described above, to stream z.</TD></TR>
<TR><TD VALIGN="TOP">CLOSE #stream</TD><TD>Unlinks any channel from the specified stream. If there is any buffered data then this is either transmitted (on the network) or recorded (on the Microdrive).</TD></TR>
<TR><TD VALIGN="TOP">ERASE &quot;m&quot;;y;&quot;name&quot;</TD><TD>Erase the file with the specified name from the cartridge in Microdrive y.</TD></TR>
<TR><TD VALIGN="TOP">FORMAT &quot;m&quot;;y;&quot;name&quot;</TD><TD>Prepare a blank Microdrive cartridge in Microdrive y for use by BASIC. The name &quot;name&quot; is given to the cartridge and this will appear in catalogues.</TD></TR>
<TR><TD VALIGN="TOP">FORMAT &quot;n&quot;;x</TD><TD>Sets the network station to x.</TD></TR>
<TR><TD VALIGN="TOP">FORMAT &quot;t&quot;;x<BR>FORMAT &quot;b&quot;;x</TD><TD>Set the baud rate for the RS 232 Interface to x (x should be chosen from one of the standard rates 50, 110, 300, 600, 1200, 2400, 4800, 9600, 19200).</TD></TR>
<TR><TD VALIGN="TOP">INKEY$ #stream</TD><TD>Returns a single character as a string if a character is available, and returns the null string &quot;&quot; if no character is available from the stream.<BR>
                        This instruction is only meaningful if the stream is linked to the network, or the RS232 Interface.</TD></TR>
<TR><TD VALIGN="TOP">INPUT #stream;variable</TD><TD>Inputs the variable from the specified stream. The stream must previously have been opened to an input channel. It is important to note that any print items in the INPUT statement will be output to the stream. This
                        is usually only required when inputting from the keyboard. It should also be noted that the &quot;,&quot; separator outputs a character.<BR>
                        The LINE option in available as before.</TD></TR>
<TR><TD VALIGN="TOP">LOAD *channel options</TD><TD>Loads the program, data or code from the specified channel. Only the channels &quot;b&quot;, &quot;n&quot; or &quot;m&quot; may be used.<BR>
                        All the options available with LOAD are available with LOAD *.</TD></TR>
<TR><TD VALIGN="TOP">MERGE *channel options</TD><TD>The same as LOAD above except that it does not delete old program lines or variables except to make way for new ones with the same line number or name.</TD></TR>
<TR><TD VALIGN="TOP">MOVE source TO destination</TD><TD>Moves data from the source to the destination. The source and destination may be either stream numbers or channels.<BR>
                        The command only terminates when an end of file marker is encountered in the source: this can only happen if the source is either a network or Microdrive channel or else a stream linked to one.<BR>
                        If the source or destination is a channel then it is effectively opened first and closed afterwards.</TD></TR>
<TR><TD VALIGN="TOP">OPEN #stream, channel</TD><TD>Links the specified channel to the specified stream in order to allow BASIC input or output to that channel. The stream must previously be closed or opened to k, s or p.</TD></TR>
<TR><TD VALIGN="TOP">PRINT #stream...</TD><TD>Outputs the print sequence (...) to the specified stream. The stream must previously have been opened to an output channel.</TD></TR>
<TR><TD VALIGN="TOP">SAVE *channel options</TD><TD>Saves the program, data or code to the specified channel. Only the channels &quot;b&quot;, &quot;n&quot; or &quot;m&quot; may be used.<BR>
                        All the options available with SAVE are available with SAVE *.</TD></TR>
<TR><TD VALIGN="TOP">VERIFY *channel options</TD><TD>The same as LOAD above except the data is not loaded but is compared with data already there.</TD></TR>
</TABLE>

<HR>
<SCRIPT LANGUAGE="JavaScript">
<!--
var modified = new Date(document.lastModified);
document.write("<H6><I>Last Updated: "+modified+"</I></H6><BR>");
// -->
</SCRIPT>
</BODY>
</HTML>
