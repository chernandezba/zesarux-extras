<!DOCTYPE html>
<html class="client-js" lang="en-GB" dir="ltr"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<title>ZX Interface 1 - Sinclair Wiki</title>
<script>document.documentElement.className="client-js";RLCONF={"wgBreakFrames":false,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"2459801922037b6452791a79","wgCSPNonce":false,"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"ZX_Interface_1","wgTitle":"ZX Interface 1","wgCurRevisionId":2363,"wgRevisionId":2363,"wgArticleId":18,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Peripherals"],"wgPageContentLanguage":"en-gb","wgPageContentModel":"wikitext","wgRelevantPageName":"ZX_Interface_1","wgRelevantArticleId":18,"wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgMFDisplayWikibaseDescriptions":{"search":false,"nearby":false,
"watchlist":false,"tagline":false},"wgVector2022PreviewPages":[]};RLSTATE={"site.styles":"ready","user.styles":"ready","user":"ready","user.options":"loading","skins.vector.styles.legacy":"ready"};RLPAGEMODULES=["site","mediawiki.page.ready","mediawiki.toc","skins.vector.legacy.js","ext.gadget.Edittools"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.implement("user.options@12s5i",function($,jQuery,require,module){mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});});});</script>
<link rel="stylesheet" href="ZX%20Interface%201%20-%20Sinclair%20Wiki_files/load.css">
<script async="" src="ZX%20Interface%201%20-%20Sinclair%20Wiki_files/load.js"></script>
<style>
@media screen {
	.toctoggle{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;font-size:94%}}</style><meta name="ResourceLoaderDynamicStyles" content="">
<link rel="stylesheet" href="ZX%20Interface%201%20-%20Sinclair%20Wiki_files/load_002.css">
<meta name="generator" content="MediaWiki 1.39.7">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1000">
<link rel="icon" href="https://sinclair.wiki.zxnet.co.uk/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="https://sinclair.wiki.zxnet.co.uk/w/opensearch_desc.php" title="Sinclair Wiki (en-gb)">
<link rel="EditURI" type="application/rsd+xml" href="https://sinclair.wiki.zxnet.co.uk/w/api.php?action=rsd">
<link rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
<link rel="alternate" type="application/atom+xml" title="Sinclair Wiki Atom feed" href="https://sinclair.wiki.zxnet.co.uk/w/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-ZX_Interface_1 rootpage-ZX_Interface_1 skin-vector action-view skin-vector-legacy vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-language-alert-in-sidebar-disabled vector-feature-sticky-header-disabled vector-feature-sticky-header-edit-disabled vector-feature-table-of-contents-disabled vector-feature-visual-enhancement-next-disabled"><div id="mw-page-base" class="noprint"></div>
<div id="mw-head-base" class="noprint"></div>
<div id="content" class="mw-body" role="main">
	<a id="top"></a>
	<div id="siteNotice"></div>
	<div class="mw-indicators">
	</div>
	<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">ZX Interface 1</span></h1>
	<div id="bodyContent" class="vector-body">
		<div id="siteSub" class="noprint">From Sinclair Wiki</div>
		<div id="contentSub"></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en-GB" dir="ltr"><div class="mw-parser-output"><p>The <b>ZX Interface 1</b> is a communications and storage interface for the ZX Spectrum released by <a href="https://sinclair.wiki.zxnet.co.uk/w/index.php?title=Sinclair_Research_Ltd.&amp;action=edit&amp;redlink=1" class="new" title="Sinclair Research Ltd. (page does not exist)">Sinclair Research</a>.
</p><p>It provided an RS-232 serial interface, as well as storage using Microdrives and networking capabilities through the <a href="https://sinclair.wiki.zxnet.co.uk/w/index.php?title=Sinclair_Network&amp;action=edit&amp;redlink=1" class="new" title="Sinclair Network (page does not exist)">Sinclair Network</a>, a proprietary interface of Sinclair's.  The Sinclair Network would later be supported by MGT's <a href="https://sinclair.wiki.zxnet.co.uk/wiki/DISCiPLE" title="DISCiPLE">DISCiPLE</a> interface.
</p>
<table class="wikitable" style="text-align: center;">

<tbody><tr>
<th rowspan="2" colspan="2" style="width: 8em;">Port
</th>
<th colspan="8">Bit
</th></tr>
<tr>
<th style="width: 5em;">7
</th>
<th style="width: 5em;">6
</th>
<th style="width: 5em;">5
</th>
<th style="width: 5em;">4
</th>
<th style="width: 5em;">3
</th>
<th style="width: 5em;">2
</th>
<th style="width: 5em;">1
</th>
<th style="width: 5em;">0
</th></tr>
<tr>
<th style="height: 8em;" rowspan="2">0xf7
</th>
<th style="height: 4em;">Read
</th>
<td>TX Data</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Net Input
</td></tr>
<tr>
<th>Write
</th>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Net Output / RX Data
</td></tr>
<tr>
<th style="height: 8em;" rowspan="2">0xef
</th>
<th style="height: 4em;">Read
</th>
<td></td>
<td></td>
<td></td>
<td>Busy</td>
<td>DTR</td>
<td>Gap</td>
<td>Sync</td>
<td>Write Protect
</td></tr>
<tr>
<th>Write
</th>
<td></td>
<td></td>
<td>Wait</td>
<td>CTS</td>
<td>Erase</td>
<td>R/W</td>
<td>Comms Clock</td>
<td>Comms Data
</td></tr>
<tr>
<th style="height: 8em;" rowspan="2">0xe7
</th>
<th style="height: 4em;">Read
</th>
<td colspan="8">Microdrive data read
</td></tr>
<tr>
<th>Write
</th>
<td colspan="8">Microdrive data write
</td></tr>
</tbody></table>
<ul><li><i>TX Data</i> is the value <b>received</b> by the serial port.</li>
<li><i>Net Input</i> is the value read from the Sinclair Network port.</li>
<li>Bit 0 of port 0x7f is output to the serial port if <i>Comms Data</i> is <b>set</b>, or to the network port if <i>Comms Data</i> is <b>reset</b>.</li>
<li><i>DTR</i> signals that the remote station wishes to send data, <i>CTS</i> signals that the Spectrum wishes to send data</li>
<li>Wait is used for network synchronisation.</li></ul>
<ul><li>When a drive is selected, it starts running automatically, and 
in the absence of "write" and "erase" signals, will start returning data
 to the Interface1, allowing it to detect gaps and syncronisation 
pulses. If it is not deselected, it will continue to run indefinitely, 
until power is removed. It is possible to turn on more than one drive at
 a time, which would result in a bus conflict and may damage the drives,
 so only one drive should ever be selected when accessing the registers 
directly from code.</li>
<li><i>Comms Data</i> is used to select which microdrive is selected. 
It's an 8 bit word, with a single bit set. The first bit in the sequence
 is Drive 8, the last one is Drive 1.</li>
<li><i>Comms Clock</i> clocks the drive selection data through the chain of microdrives.</li></ul>
<ul><li>When <i>Erase</i> is <b>reset</b> the tape is erased. Typically 
turns on 2ms before writing, and although it turns off with the end of 
write, takes around 2ms to stop erasing.</li>
<li><i>R/W</i> instructs the microdrive to read or write. When <i>R/W</i> is <b>set</b> the data channel reads, when <b>reset</b> the data channel writes. Used in conjunction with ERASE.</li>
<li><i>Write Protect</i> indicates that a cartridge is write protected. 
If a drive that is not connected is accessed, it will be in "protect" by
 default to prevent format commands from working.</li>
<li><i>Gap</i> and <i>Sync</i> are used to locate the correct block of 
data on the microdrive. They are produced by the ULA which decodes the 
synchronisation pulses and detects the gaps in between sectors and 
between the sector file and the record file.</li></ul>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none"><div class="toctitle" lang="en-GB" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Interface_1_Pin_Assignments"><span class="tocnumber">1</span> <span class="toctext">Interface 1 Pin Assignments</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Microdrive_Edge_Connector"><span class="tocnumber">1.1</span> <span class="toctext">Microdrive Edge Connector</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3"><a href="#Microdrive_Performance_Characteristics"><span class="tocnumber">2</span> <span class="toctext">Microdrive Performance Characteristics</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Microdrive_Data_Storage_Format"><span class="tocnumber">3</span> <span class="toctext">Microdrive Data Storage Format</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Sector,_including_header_and_data"><span class="tocnumber">3.1</span> <span class="toctext">Sector, including header and data</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Sector_Header"><span class="tocnumber">3.2</span> <span class="toctext">Sector Header</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Sector_Data"><span class="tocnumber">3.3</span> <span class="toctext">Sector Data</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Calculating_the_checksum"><span class="tocnumber">3.4</span> <span class="toctext">Calculating the checksum</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="#External_links"><span class="tocnumber">4</span> <span class="toctext">External links</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Interface_1_Pin_Assignments">Interface 1 Pin Assignments</span></h2>
<p>The Interface 1 pin assignments contain 7 data pins, one of which is a
 high-voltage open-collector data pin, a 9v supply and several ground 
pins as well as a 2-pin keyway to avoid incorrect insertion. This is all
 configured as a 16 pin edge connector to connect to an IDC ( Insulation
 Displacement Connector ) plug.
</p>
<h3><span class="mw-headline" id="Microdrive_Edge_Connector">Microdrive Edge Connector</span></h3>
<table class="wikitable" style="text-align: center;">

<tbody><tr>
<th rowspan="2" colspan="2" style="width: 8em;">PIN
</th>
<th colspan="8">Edge Connector
</th></tr>
<tr>
<th style="width: 5em;">15
</th>
<th style="width: 5em;">13
</th>
<th style="width: 5em;">11
</th>
<th style="width: 5em;">09
</th>
<th style="width: 5em;">07
</th>
<th style="width: 5em;">05
</th>
<th style="width: 5em;">03
</th>
<th style="width: 5em;">01
</th></tr>
<tr>
<th style="height: 8em;" rowspan="2">Function
</th>
<th style="height: 4em;">TOP
</th>
<td>GND</td>
<td>GND</td>
<td>GND</td>
<td>ERASE</td>
<td>Comms Data</td>
<td>KEY</td>
<td>Comms Clk</td>
<td>D1
</td></tr>
<tr>
<th>BOTTOM
</th>
<td>GND</td>
<td>GND</td>
<td>GND</td>
<td>R/W</td>
<td>9v</td>
<td>KEY</td>
<td>WR-PROT</td>
<td>D0
</td></tr>
<tr>
<th rowspan="2" colspan="2" style="width: 8em;">PIN
</th>
<th style="width: 5em;">16
</th>
<th style="width: 5em;">14
</th>
<th style="width: 5em;">12
</th>
<th style="width: 5em;">10
</th>
<th style="width: 5em;">08
</th>
<th style="width: 5em;">06
</th>
<th style="width: 5em;">04
</th>
<th style="width: 5em;">02
</th></tr>
<tr>
<th colspan="8">
<p>Interface 1 connector Viewed from side.
</p>
</th></tr>
</tbody></table>
<p>Signals:
</p>
<ul><li>D0/D1 - Interleaved data, a byte at a time, from each of the 
read/write heads in the microdrive. Data rate approximately 80 Kbps per 
track. TTL Level.</li>
<li>Comms Clock - Drive select clock, identifies which drive to turn on. TTL level.</li>
<li>WR-PROT - A "low" on this indicates a cartridge is write protected. 9 volt = Not protected.</li>
<li>Comms Data - Drive select is serially clocked through drives. Logic 1 = selected. Line is inverted from register. TTL Level.</li>
<li>9v - Power supply for drive.</li>
<li>ERASE - Open Collector via 270 Ohm resistor, to ERASE head on 
selected microdrive. Typically sits between 10v and 6v (6v=ERASE) when 
active.</li>
<li>R/W - Write is active low. Select to read or write data to drive. TTL level.</li></ul>
<h2><span class="mw-headline" id="Microdrive_Performance_Characteristics">Microdrive Performance Characteristics</span></h2>
<p>In many ways, the Microdrive, despite it's simple construction, 
performed similarly to disk systems of the era, and was roughly as fast 
at loading, however the lack of file allocation tables on the disk meant
 that the file allocation tables had to be build prior to every write 
operation, slowing down write access. 
</p>
<ul><li>"Infinite loop" - Repeating magnetic tape.</li>
<li>Two tracks, operating as a single interleaved track.</li>
<li>Byte by byte interleave ( Even bytes Track 0, Odd bytes Track 1, Interleave every 4 bits. )</li>
<li>Directoryless Data Structure.</li>
<li>Typical Capacity 90 Kb</li>
<li>160 Kbps Data Transfer Rate ( 20 Kbytes/second raw transfer rate )</li>
<li>Data encoded using Biphase Frequency Modulation ( same coding as credit card )</li>
<li>Does not support a cartridge change line - All sectors must be eximined before writing data.</li>
<li>Typical full cycle time of around 8 to 10 seconds.</li>
<li>Can handle media stretching and data rate change without losing data.</li></ul>
<h2><span class="mw-headline" id="Microdrive_Data_Storage_Format">Microdrive Data Storage Format</span></h2>
<p>The microdrive is arranged as an unspecified number of sectors, at a 
maximum of 254 sectors, each of 512 Kb, allowing for a theoretical 
maximum of 127Kb per cartridge. Theoretically it is also possible to 
exceed this in "Read Only" mode as long as Record 0 of a file can be 
read before the Interface 1 times out, as the read routine appears to 
match on name and record number without any reference to sectors. 
</p><p>Each sector consists of two files, each similar. There is the 
Sector Header, which is a 15 byte file record, or the data record 
recorded after the sector header, which is 528 bytes, including one 
"sacrificial byte" on the D1 data line, which does not contribute to the
 data stored, though could be modified into a high-order byte checksum 
in the future to improve data integrity on older cartridges.
</p><p>All bytes are written LSB ( Least Significant Bit ) first. Here's
 how to read the images, as data is spread across two data lines. 
</p><p><a href="https://sinclair.wiki.zxnet.co.uk/wiki/File:How_to_read_the_decodes.png" class="image"><img alt="How to read the decodes.png" src="ZX%20Interface%201%20-%20Sinclair%20Wiki_files/How_to_read_the_decodes.png" decoding="async" width="920" height="235"></a>
</p>
<h3><span id="Sector.2C_including_header_and_data"></span><span class="mw-headline" id="Sector,_including_header_and_data">Sector, including header and data</span></h3>
<p>As the spectrum uses soft-coded sectors, without any indication of 
tape start and end, each Microdrive cartridge is a collection of sectors
 that present sequentially to the reader and are read at random, 
depending on where the loop happens to be when a particular read 
operation occurs. The sectors do not require to be in order, or to 
follow any convention. Typical sectors are sequential in nature, however
 interleave to allow time for internal transfer between reading and 
writing sectors seems to be accomplished through the process, such that 
any new writes rarely write in two physically consecutive sectors. The 
sector format includes a header and a record. The header is only written
 during the format operation, while the record can be written at any 
time it is unused. Bit 2 in the RECFLAG byte, the first byte of the 
sector, identifies whether it is in used. If set, it is used. If unset, 
it is not used. 
</p><p><a href="https://sinclair.wiki.zxnet.co.uk/wiki/File:Logic_Analysis_of_sector_Header_and_Data_sections_with_gaps.png" class="image"><img alt="Logic Analysis of sector Header and Data sections with gaps.png" src="ZX%20Interface%201%20-%20Sinclair%20Wiki_files/Logic_Analysis_of_sector_Header_and_Data_sections_with_gaps.png" decoding="async" width="2045" height="424"></a>
</p><p>Each of these structures is similar, apart from length, and can 
be examined independently. From this image, it can be seen that the 
ERASE line turns on just before the R/W line begins writing the sector. 
In this case, the Sector Header has been read, and it has been 
determined previously when the sector map was constructed that this 
sector can be written to. The ERASE is activated, and then the R/W is 
activated (active low ) just prior to writing data.
</p>
<h3><span class="mw-headline" id="Sector_Header">Sector Header</span></h3>
<p>Each sector header is 15 bytes long, and follows the same format as 
the Data Header which follows it, though omits the data itself, and the 
filename is replaced with the cartridge name. The Received File Flags 
(RECFLG In the Disassembly) seems to use Bit 0,1 and 2. Only Bit0 is set
 in the Sector Header. This identifies it as a sector marker, and so it 
is used to find the correct sector when writing. Reading does not pay 
attention to the Sector identifier file. Also, the record number field 
is the Sector Number field in this case.
</p><p><a href="https://sinclair.wiki.zxnet.co.uk/wiki/File:Sector130_Header_with_cartridge_name_Microdrive.png" class="image"><img alt="Sector130 Header with cartridge name Microdrive.png" src="ZX%20Interface%201%20-%20Sinclair%20Wiki_files/Sector130_Header_with_cartridge_name_Microdrive.png" decoding="async" width="3229" height="427"></a>
</p><p>In this file, the first 12 bytes, sometimes erroneously 
identified as "12 bytes for identification", are actually 6 sync bytes 
per channel. These provide information to the Interface1, along with the
 preceding gap, that valid data is about to follow and establish the 
necessary conditions for the Interface1 software to begin reading Sector
 Headers and Sector Data contents. 
</p><p>In the above image, they are identified as 
0x00,0x00,0x00,0x00,0x00,0xFF. Spurious bits prior to this sequence have
 been ignored in the above example, but are common in the process. 
</p><p>Immediately following this, bytes are read in order, from the bottom row to the top, and would form the following Sector Record.
</p>
<table class="wikitable" style="text-align: center;">

<tbody><tr>
<td>Offset</td>
<td>Example Byte</td>
<td>Significance
</td></tr>
<tr>
<td>00H</td>
<td>0x01</td>
<td>This is the RECFLG byte. Bit0 signifies a sector header.
</td></tr>
<tr>
<td>01H</td>
<td>0x82</td>
<td>Sector 0x82. Sectors count from 0xFF to 0x00. Sector 130 in decimal.
</td></tr>
<tr>
<td>02H</td>
<td>0xEB</td>
<td>Undefined. Not in use at the present time.
</td></tr>
<tr>
<td>03H</td>
<td>0x20</td>
<td>Undefined. Not in use at the present time.
</td></tr>
<tr>
<td>04H-0DH</td>
<td>0x4D, 0x69, 0x63, 0x72, 0x6F, 0x64, 0x72, 0x69, 0x76, 0x65</td>
<td>Cartridge name, in this case, the cartridge was formatted with <i>FORMAT "M";1;"Microdrive"</i> Any unused name spaces are padded with 0x20
</td></tr>
<tr>
<td>0EH</td>
<td>0xA7</td>
<td>The Sector Header Checksum...
</td></tr>
</tbody></table>
<p>There is also a final byte clearly visible at 0xFH, which would make 
the 16th byte, however this is a wasted byte and does not support 
anything. It may well be used for a 16bit checksum in the future.
</p><p><br>
</p>
<h3><span class="mw-headline" id="Sector_Data">Sector Data</span></h3>
<p>Data files, or "Records" follow each Sector Header file. These are 
528 bytes long, and include the same synchronisation pulses at the start
 as the Sector Header.  In addition, while the DATA content of the 
record is 512 bytes, some spectrum files have a header that parallels 
the tape header, though obviously omits the filename as that's contained
 within the record preamble. As such this data stream contains;
</p><p>12 bytes ( 6 per channel ) of synchronisation pulses ( possibly with some spurious additional pulses ) 
</p><p>15 bytes of Preamble, containing the filename, record number and Received Flags.
</p><p>512 bytes of record data and;
</p><p>1 wasted byte ( that also might be used for a 16 bit checksum in the future )
</p><p><a href="https://sinclair.wiki.zxnet.co.uk/wiki/File:Sector_record_file_example.png" class="image"><img alt="Sector record file example.png" src="ZX%20Interface%201%20-%20Sinclair%20Wiki_files/Sector_record_file_example.png" decoding="async" width="3046" height="431"></a>
</p><p><br>
In this example, it can be seen that the identifier section ( preamble )
 is very similar to the format of the Sector Header identifier section. 
The same routines read both in the Interface 1 ROM. Also, as with the 
Sector Header, the first 12 bytes are synchronisation pulses. 
</p><p><br>
</p>
<table class="wikitable" style="text-align: center;">

<tbody><tr>
<td>Offset</td>
<td>Example Byte</td>
<td>Significance
</td></tr>
<tr>
<td>00H</td>
<td>0x04</td>
<td>This is the RECFLG byte. Bit2 signifies that the sector is in use. 
If it was the final sector in the record, then it would be 0x06, as Bit1
 signifies that it is the final record. (EOF)
</td></tr>
<tr>
<td>01H</td>
<td>0x00</td>
<td>Record Segment 0x00. Segments count from 0x00 to 0xFF.
</td></tr>
<tr>
<td>02H-03H</td>
<td>0x00, 0x02</td>
<td>Record length. Will always be 0x0200H unless the RECFLG is 0x06. Number of bytes to read.
</td></tr>
<tr>
<td>04H-0DH</td>
<td>0x53, 0x65, 0x71, 0x75, 0x65, 0x6E, 0x74, 0x69, 0x61, 0x6c</td>
<td>The filename, in this case, "Sequential". It was generated with <i>SAVE *"M";1;"Sequential" CODE 40000,512</i>
</td></tr>
<tr>
<td>0EH</td>
<td>0x25</td>
<td>The Header Checksum.
</td></tr>
</tbody></table>
<p>Additionally, it can be seen that the Data Stream then begins with; 
0x03, 0x00, 0x02, 0x40, 0x9C, 0xFF, 0xFF, 0xFF, 0xFF before the data 
that was saved (ie, 0x00, 0x01, 0x02, 0x03... ) is saved.
</p><p>This is the file header and can only be found in Record 0 for any
 file, and is always 9 bytes long. It has the following meanings.
</p>
<table class="wikitable" style="text-align: center;">

<tbody><tr>
<td>Offset</td>
<td>Example Byte</td>
<td>Significance
</td></tr>
<tr>
<td>00H</td>
<td>0x03</td>
<td>File Type. 00=Basic Program, 01=Numeric Array, 02=Character Array, 03=CODE Function.
</td></tr>
<tr>
<td>01H-02H</td>
<td>0x00, 0x02H</td>
<td>File Length (0x0200H bytes = 512 Bytes )
</td></tr>
<tr>
<td>03H-04H</td>
<td>0x40, 0x9CH</td>
<td>Place it was saved from (Used for code only, but populated for all file types)
</td></tr>
<tr>
<td>05H-06H</td>
<td>0xFF, 0xFFH</td>
<td>
<ul><li>BASIC: start of variables area in file.</li>
<li>Numeric arrays: [5] = 0x80 + (variable name - 'A')</li>
<li>Char array: [5] =  0xC0 + (variable name - 'A')</li>
<li>Code: Unused (Should be FFh FFh)</li></ul>
</td></tr>
<tr>
<td>07H-08H</td>
<td>0xFF, 0xFF</td>
<td>For BASIC, Autorun line no (lsb first, 0x00 0x80 = No autorun), $FF for all other file types.
</td></tr>
<tr>
<td>09H-01FFH</td>
<td>0x00, 0x01, 0x02, 0x04 etc... to 0xFF</td>
<td>The first 503 bytes of actual saved data. Anything more than this gets saved in the next sector.
</td></tr>
<tr>
<td>0200H</td>
<td>0xnn</td>
<td>The data checksum.
</td></tr>
</tbody></table>
<h3><span class="mw-headline" id="Calculating_the_checksum">Calculating the checksum</span></h3>
<p>The checksum isn't a standard checksum, a parity, a logitudinal redundancy check or a a two's compliment checksum. 
</p><p>It starts as a basic 8-bit sum of each of the characters, but has
 additional calculated bits inserted to avoid the sum "255" ever being 
calculated at any stage during the sum process. 
</p><p>The assembly language in the Interface1 ROM is called with HL 
pointing to the buffer where the microdrive data is stored. It looks 
like this (below); 
</p><p><br>
</p>
<table class="wikitable" style="text-align: left;">

<tbody><tr>
<td>SECTOR:</td>
<td>LD BC,$000E</td>
<td>14 bytes in the header. Entry point for headers, location 0x1426.
</td></tr>
<tr>
<td></td>
<td>JR      SUM</td>
<td>Calculate the checksum.
</td></tr>
<tr>
<td>RECORD:</td>
<td>LD BC,$0200</td>
<td>200 bytes in the record. Location 0x142B
</td></tr>
<tr>
<td>SUM:</td>
<td>PUSH    HL</td>
<td>Enter with HL pointing to the buffer, either at the header, or the record contents. Store the start.
</td></tr>
<tr>
<td></td>
<td>LD      E,$00</td>
<td>Zero the checksum to start.
</td></tr>
<tr>
<td>LOOP:</td>
<td>LD      A,E</td>
<td>Pick up the current checksum.
</td></tr>
<tr>
<td></td>
<td>ADD     A,(HL)</td>
<td>Add a byte from the buffer to the checksum.
</td></tr>
<tr>
<td></td>
<td>INC     HL</td>
<td>Move the pointer to the next byte in the buffer.
</td></tr>
<tr>
<td></td>
<td>ADC     A,$01</td>
<td>Here's where it gets complicated. If the previous add overflowed, add Carry plus 1 ( add 2 ). Otherwise just add 1.
</td></tr>
<tr>
<td></td>
<td>JR      Z,SKIP</td>
<td>However if the last checksum calculation was 0FF, now it will be 
zero, and the zero flag set. If it's zero, skip the next instruction.
</td></tr>
<tr>
<td></td>
<td>DEC     A</td>
<td>If not skipped, remove the 1 just added, however if two were added, 
then just subtract 1. If it was 0FF, just leave it as 00 now.
</td></tr>
<tr>
<td>SKIP:</td>
<td>LD E,A</td>
<td>Store the sum so far...
</td></tr>
<tr>
<td></td>
<td>DEC     BC</td>
<td>Reduce the counter of bytes in the buffer.
</td></tr>
<tr>
<td></td>
<td>LD      A,B</td>
<td>We need to test if the counter is zero.
</td></tr>
<tr>
<td></td>
<td>OR      C</td>
<td>Set the zero flag now if BC is zero.
</td></tr>
<tr>
<td></td>
<td>JR      NZ,LOOP</td>
<td>If we haven't summed all the bytes in the buffer, loop back and iterate.
</td></tr>
<tr>
<td></td>
<td>LD      A,E</td>
<td>Collect the checksum.
</td></tr>
<tr>
<td></td>
<td>CP      (HL)</td>
<td>Byte after the buffer is where the checksum should be stored. Test the calculated checksum against the stored checksum.
</td></tr>
<tr>
<td></td>
<td>LD      (HL),A</td>
<td>And regardless of whether it's right or wrong, write the correct 
checksum in there now... So this routine both checks and calculates the 
checksum.
</td></tr>
<tr>
<td></td>
<td>POP     HL</td>
<td>Retrieve HL to point to the start of the buffer again.
</td></tr>
<tr>
<td></td>
<td>RET</td>
<td>Zero flag is set if the checksum was correct. Can be tested by the routine that called this one.
</td></tr>
</tbody></table>
<p>The Pseudocode for this process, if calculated in a high level language looks something like this;
</p>
<table class="wikitable" style="text-align: left;">

<tbody><tr>
<td>Checksum = 0
</td></tr>
<tr>
<td>while (bytes in buffer) do
</td></tr>
<tr>
<td>...Add byte to checksum
</td></tr>
<tr>
<td>...If checksum=255 then checksum=0
</td></tr>
<tr>
<td>...If checksum&gt;255 then checksum=(checksum modulo 256)+1
</td></tr>
<tr>
<td>done
</td></tr>
</tbody></table>
<h2><span class="mw-headline" id="External_links">External links</span></h2>
<ul><li><a href="https://en.wikipedia.org/wiki/ZX_Interface_1" class="extiw" title="wikipedia:ZX Interface 1">Wikipedia's article on the ZX Interface 1</a></li></ul>
<!-- 
NewPP limit report
Cached time: 20241028163552
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc]
CPU time usage: 0.060 seconds
Real time usage: 0.065 seconds
Preprocessor visited node count: 34/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 0/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->

<!-- Saved in parser cache with key sinclair?hwiki-mw_:pcache:idhash:18-0!canonical and timestamp 20241028163552 and revision id 2363.
 -->
</div>
<div class="printfooter" data-nosnippet="">Retrieved from ‘<a dir="ltr" href="https://sinclair.wiki.zxnet.co.uk/w/index.php?title=ZX_Interface_1&amp;oldid=2363">https://sinclair.wiki.zxnet.co.uk/w/index.php?title=ZX_Interface_1&amp;oldid=2363</a>’</div></div>
		<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="https://sinclair.wiki.zxnet.co.uk/wiki/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="https://sinclair.wiki.zxnet.co.uk/wiki/Category:Peripherals" title="Category:Peripherals">Peripherals</a></li></ul></div></div>
	</div>
</div>

<div id="mw-navigation">
	<h2>Navigation menu</h2>
	<div id="mw-head">
		

<nav id="p-personal" class="vector-menu mw-portlet mw-portlet-personal vector-user-menu-legacy" aria-labelledby="p-personal-label" role="navigation">
	<h3 id="p-personal-label" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">Personal tools</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"><li id="pt-login" class="mw-list-item"><a href="https://sinclair.wiki.zxnet.co.uk/w/index.php?title=Special:UserLogin&amp;returnto=ZX+Interface+1" title="You are encouraged to log in; however, it is not mandatory [⌃⌥o]" accesskey="o"><span>Log in</span></a></li><li id="pt-createaccount" class="mw-list-item"><a href="https://sinclair.wiki.zxnet.co.uk/wiki/Special:RequestAccount" title="You are encouraged to create an account and log in; however, it is not mandatory"><span>Request account</span></a></li></ul>
		
	</div>
</nav>

		<div id="left-navigation">
			

<nav id="p-namespaces" class="vector-menu mw-portlet mw-portlet-namespaces vector-menu-tabs vector-menu-tabs-legacy" aria-labelledby="p-namespaces-label" role="navigation">
	<h3 id="p-namespaces-label" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">Namespaces</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"><li id="ca-nstab-main" class="selected mw-list-item"><a href="https://sinclair.wiki.zxnet.co.uk/wiki/ZX_Interface_1" title="View the content page [⌃⌥c]" accesskey="c"><span>Page</span></a></li><li id="ca-talk" class="new mw-list-item"><a href="https://sinclair.wiki.zxnet.co.uk/w/index.php?title=Talk:ZX_Interface_1&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page (page does not exist) [⌃⌥t]" accesskey="t"><span>Discussion</span></a></li></ul>
		
	</div>
</nav>

			

<nav id="p-variants" class="vector-menu mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown" aria-labelledby="p-variants-label" role="navigation">
	<input type="checkbox" id="p-variants-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-variants" class="vector-menu-checkbox" aria-labelledby="p-variants-label">
	<label id="p-variants-label" aria-label="Change language variant" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">British English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</nav>

		</div>
		<div id="right-navigation">
			

<nav id="p-views" class="vector-menu mw-portlet mw-portlet-views vector-menu-tabs vector-menu-tabs-legacy" aria-labelledby="p-views-label" role="navigation">
	<h3 id="p-views-label" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">Views</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"><li id="ca-view" class="selected mw-list-item collapsible"><a href="https://sinclair.wiki.zxnet.co.uk/wiki/ZX_Interface_1"><span>Read</span></a></li><li id="ca-viewsource" class="mw-list-item collapsible"><a href="https://sinclair.wiki.zxnet.co.uk/w/index.php?title=ZX_Interface_1&amp;action=edit" title="This page is protected.
You can view its source [⌃⌥e]" accesskey="e"><span>View source</span></a></li><li id="ca-history" class="mw-list-item collapsible"><a href="https://sinclair.wiki.zxnet.co.uk/w/index.php?title=ZX_Interface_1&amp;action=history" title="Past revisions of this page [⌃⌥h]" accesskey="h"><span>View history</span></a></li></ul>
		
	</div>
</nav>

			

<nav id="p-cactions" class="vector-menu mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown" aria-labelledby="p-cactions-label" role="navigation" title="More options">
	<input type="checkbox" id="p-cactions-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-cactions" class="vector-menu-checkbox" aria-labelledby="p-cactions-label">
	<label id="p-cactions-label" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"></ul>
		
	</div>
</nav>

			
<div id="p-search" role="search" class="vector-search-box-vue  vector-search-box-show-thumbnail vector-search-box-auto-expand-width vector-search-box">
	<div>
			<h3>
				<label for="searchInput">Search</label>
			</h3>
		<form action="/w/index.php" id="searchform" class="vector-search-box-form">
			<div id="simpleSearch" class="vector-search-box-inner" data-search-loc="header-navigation">
				<input class="vector-search-box-input" type="search" name="search" placeholder="Search Sinclair Wiki" aria-label="Search Sinclair Wiki" autocapitalize="sentences" title="Search Sinclair Wiki [⌃⌥f]" accesskey="f" id="searchInput">
				<input type="hidden" name="title" value="Special:Search">
				<input id="mw-searchButton" class="searchButton mw-fallbackSearchButton" type="submit" name="fulltext" title="Search pages for this text" value="Search">
				<input id="searchButton" class="searchButton" type="submit" name="go" title="Go to a page with this exact name if it exists" value="Go">
			</div>
		</form>
	</div>
</div>

		</div>
	</div>
	

<div id="mw-panel">
	<div id="p-logo" role="banner">
		<a class="mw-wiki-logo" href="https://sinclair.wiki.zxnet.co.uk/wiki/Main_Page" title="Visit the main page"></a>
	</div>
	

<nav id="p-navigation" class="vector-menu mw-portlet mw-portlet-navigation vector-menu-portal portal" aria-labelledby="p-navigation-label" role="navigation">
	<h3 id="p-navigation-label" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">Navigation</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"><li id="n-mainpage-description" class="mw-list-item"><a href="https://sinclair.wiki.zxnet.co.uk/wiki/Main_Page" title="Visit the main page [⌃⌥z]" accesskey="z"><span>Main page</span></a></li><li id="n-recentchanges" class="mw-list-item"><a href="https://sinclair.wiki.zxnet.co.uk/wiki/Special:RecentChanges" title="A list of recent changes in the wiki [⌃⌥r]" accesskey="r"><span>Recent changes</span></a></li><li id="n-randompage" class="mw-list-item"><a href="https://sinclair.wiki.zxnet.co.uk/wiki/Special:Random" title="Load a random page [⌃⌥x]" accesskey="x"><span>Random page</span></a></li><li id="n-help-mediawiki" class="mw-list-item"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents"><span>Help about MediaWiki</span></a></li></ul>
		
	</div>
</nav>

	

<nav id="p-tb" class="vector-menu mw-portlet mw-portlet-tb vector-menu-portal portal" aria-labelledby="p-tb-label" role="navigation">
	<h3 id="p-tb-label" class="vector-menu-heading ">
		<span class="vector-menu-heading-label">Tools</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list"><li id="t-whatlinkshere" class="mw-list-item"><a href="https://sinclair.wiki.zxnet.co.uk/wiki/Special:WhatLinksHere/ZX_Interface_1" title="A list of all wiki pages that link here [⌃⌥j]" accesskey="j"><span>What links here</span></a></li><li id="t-recentchangeslinked" class="mw-list-item"><a href="https://sinclair.wiki.zxnet.co.uk/wiki/Special:RecentChangesLinked/ZX_Interface_1" rel="nofollow" title="Recent changes in pages linked from this page [⌃⌥k]" accesskey="k"><span>Related changes</span></a></li><li id="t-specialpages" class="mw-list-item"><a href="https://sinclair.wiki.zxnet.co.uk/wiki/Special:SpecialPages" title="A list of all special pages [⌃⌥q]" accesskey="q"><span>Special pages</span></a></li><li id="t-print" class="mw-list-item"><a href="javascript:print();" rel="alternate" title="Printable version of this page [⌃⌥p]" accesskey="p"><span>Printable version</span></a></li><li id="t-permalink" class="mw-list-item"><a href="https://sinclair.wiki.zxnet.co.uk/w/index.php?title=ZX_Interface_1&amp;oldid=2363" title="Permanent link to this revision of this page"><span>Permanent link</span></a></li><li id="t-info" class="mw-list-item"><a href="https://sinclair.wiki.zxnet.co.uk/w/index.php?title=ZX_Interface_1&amp;action=info" title="More information about this page"><span>Page information</span></a></li></ul>
		
	</div>
</nav>

	
</div>

</div>

<footer id="footer" class="mw-footer" role="contentinfo">
	<ul id="footer-info">
	<li id="footer-info-lastmod"> This page was last modified on 7 January 2023, at 17:17.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike</a> unless otherwise noted.</li>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://sinclair.wiki.zxnet.co.uk/wiki/Sinclair_Wiki:Privacy_policy">Privacy policy</a></li>
	<li id="footer-places-about"><a href="https://sinclair.wiki.zxnet.co.uk/wiki/Sinclair_Wiki:About">About Sinclair Wiki</a></li>
	<li id="footer-places-disclaimer"><a href="https://sinclair.wiki.zxnet.co.uk/wiki/Sinclair_Wiki:General_disclaimer">Disclaimers</a></li>
	<li id="footer-places-mobileview"><a href="https://sinclair.wiki.zxnet.co.uk/w/index.php?title=ZX_Interface_1&amp;mobileaction=toggle_view_mobile" class="noprint stopMobileRedirectToggle">Mobile view</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="http://creativecommons.org/licenses/by-sa/4.0/"><img src="ZX%20Interface%201%20-%20Sinclair%20Wiki_files/cc-by-sa.png" alt="Creative Commons Attribution-ShareAlike" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><a href="https://www.mediawiki.org/"><img src="ZX%20Interface%201%20-%20Sinclair%20Wiki_files/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="ZX%20Interface%201%20-%20Sinclair%20Wiki_files/poweredby_mediawiki_132x47.png 1.5x, ZX%20Interface%201%20-%20Sinclair%20Wiki_files/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></a></li>
</ul>

</footer>

<script>(RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.060","walltime":"0.065","ppvisitednodes":{"value":34,"limit":1000000},"postexpandincludesize":{"value":0,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":100},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":0,"limit":5000000},"timingprofile":["100.00%    0.000      1 -total"]},"cachereport":{"timestamp":"20241028163552","ttl":86400,"transientcontent":false}}});mw.config.set({"wgBackendResponseTime":203});});</script>

</body></html>